<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Simple CRM ‚Äî —É–º–Ω–∞—è CRM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
        }
        body {
            background: #f4f6fa;
            padding: 16px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .app {
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
            background: white;
            border-radius: 28px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.05);
            padding: 20px;
        }
        h1 {
            font-size: 1.8rem;
            font-weight: 600;
            color: #0b1b32;
            margin-bottom: 4px;
        }
        .subtitle {
            color: #5a6a7e;
            font-size: 0.95rem;
            margin-bottom: 16px;
            border-bottom: 1px solid #e9edf2;
            padding-bottom: 12px;
        }
        /* –û–±—É—á–µ–Ω–∏–µ (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞) */
        .onboarding {
            background: #e8f0fe;
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            border: 1px solid #cdddec;
        }
        .onboarding-text {
            flex: 1;
        }
        .onboarding-text p {
            margin-bottom: 8px;
            color: #1e2b3f;
        }
        .onboarding button {
            background: transparent;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #5a7a9a;
        }
        .pricing {
            background: #eef2f6;
            border-radius: 18px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }
        .plan {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .badge {
            border-radius: 40px;
            padding: 6px 14px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        .badge.free {
            background: white;
            border: 1px solid #cbd5e1;
            color: #334155;
        }
        .badge.pro {
            background: #0b1b32;
            color: white;
        }
        .price {
            font-weight: 700;
            font-size: 1.1rem;
            color: #0b1b32;
        }
        .tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 20px;
            background: #f0f3f7;
            padding: 6px;
            border-radius: 40px;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 10px 2px;
            font-weight: 500;
            border-radius: 30px;
            background: transparent;
            border: none;
            font-size: 0.95rem;
            color: #4a5a6e;
            transition: 0.2s;
            cursor: pointer;
        }
        .tab.active {
            background: white;
            color: #0b1b32;
            box-shadow: 0 4px 12px rgba(0,0,0,0.04);
            font-weight: 600;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        /* –ü–æ–∏—Å–∫ */
        .search-box {
            margin-bottom: 15px;
            display: flex;
            gap: 8px;
        }
        .search-box input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #dce3ec;
            border-radius: 40px;
            font-size: 1rem;
            background: white;
        }
        .list-container {
            margin-bottom: 15px;
        }
        .list-item {
            background: #fafbfd;
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e9edf2;
            transition: 0.1s;
        }
        .item-info h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .item-info p {
            font-size: 0.9rem;
            color: #5f6c80;
        }
        .item-actions {
            display: flex;
            gap: 8px;
        }
        button {
            background: white;
            border: 1px solid #d0d9e4;
            border-radius: 30px;
            padding: 8px 16px;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: 0.2s;
            color: #1e293b;
        }
        button.primary {
            background: #0b1b32;
            border-color: #0b1b32;
            color: white;
        }
        button.small {
            padding: 6px 12px;
            font-size: 0.8rem;
        }
        .add-button {
            width: 100%;
            padding: 14px;
            background: #0b1b32;
            color: white;
            border: none;
            border-radius: 60px;
            font-weight: 600;
            font-size: 1rem;
            margin: 10px 0 5px;
        }
        .empty-state {
            text-align: center;
            color: #8a99aa;
            padding: 30px 20px;
            background: #f9fbfd;
            border-radius: 28px;
            font-size: 1rem;
        }
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.3);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 16px;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: white;
            border-radius: 32px;
            max-width: 500px;
            width: 100%;
            padding: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
        }
        .modal-content h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        .modal-content input,
        .modal-content textarea,
        .modal-content select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #dce3ec;
            border-radius: 40px;
            font-size: 1rem;
            margin-bottom: 16px;
            background: white;
        }
        .modal-content textarea {
            border-radius: 24px;
            min-height: 100px;
        }
        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        .modal-actions button {
            flex: 1;
            padding: 14px;
        }
        .limit-warning {
            background: #fff1e0;
            border-radius: 40px;
            padding: 12px 18px;
            font-size: 0.9rem;
            color: #a15400;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .footer-note {
            margin-top: 30px;
            font-size: 0.8rem;
            color: #8b99aa;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="app">
    <h1>Simple CRM</h1>
    <div class="subtitle">–¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–¥–∞–∂</div>

    <!-- –û–Ω–±–æ—Ä–¥–∏–Ω–≥ (–æ–±—É—á–µ–Ω–∏–µ) -->
    <div id="onboarding-message" class="onboarding">
        <div class="onboarding-text">
            <p>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –≠—Ç–æ –ø—Ä–æ—Å—Ç–∞—è CRM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏.</p>
            <p><strong>–ö–æ–Ω—Ç–∞–∫—Ç—ã</strong> ‚Äî —Ö—Ä–∞–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤.<br>
               <strong>–°–¥–µ–ª–∫–∏</strong> ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–¥–∞–∂–∏.<br>
               <strong>–ó–∞–º–µ—Ç–∫–∏</strong> ‚Äî –≤–∞–∂–Ω—ã–µ –ø–æ–º–µ—Ç–∫–∏.<br>
               <strong>–û–±–∑–æ—Ä</strong> ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è.</p>
            <p>–ù–∞–∂–º–∏—Ç–µ + —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</p>
        </div>
        <button id="close-onboarding">‚úï</button>
    </div>

    <!-- –¢–∞—Ä–∏—Ñ—ã –∏ –ª–∏–º–∏—Ç -->
    <div class="pricing">
        <div class="plan">
            <span class="badge free">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
            <span class="badge pro">PRO 990 ‚ÇΩ/–º–µ—Å</span>
        </div>
        <div class="price" id="contact-counter">0 / 10 –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤</div>
    </div>
    <div id="limit-warning" class="limit-warning" style="display: none;">
        ‚ö†Ô∏è –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–∏–º–∏—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (10) –∏—Å—á–µ—Ä–ø–∞–Ω. –£–¥–∞–ª–∏—Ç–µ –ª–∏—à–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ PRO.
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="tabs">
        <button class="tab active" data-tab="dashboard">–û–±–∑–æ—Ä</button>
        <button class="tab" data-tab="contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</button>
        <button class="tab" data-tab="deals">–°–¥–µ–ª–∫–∏</button>
        <button class="tab" data-tab="notes">–ó–∞–º–µ—Ç–∫–∏</button>
    </div>

    <!-- –†–∞–∑–¥–µ–ª –î–∞—à–±–æ—Ä–¥ -->
    <div id="dashboard" class="section active">
        <div style="background: #eef2f6; border-radius: 28px; padding: 20px; margin-bottom: 15px;">
            <h3 style="margin-bottom: 15px;">üìä –ë—ã—Å—Ç—Ä—ã–π –æ–±–∑–æ—Ä</h3>
            <div id="dashboard-stats"></div>
        </div>
        <div style="margin-top: 15px;">
            <h4 style="margin-bottom: 10px;">üïí –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</h4>
            <div id="recent-activity" class="list-container"></div>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
    <div id="contacts" class="section">
        <div class="search-box">
            <input type="text" id="search-contacts" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, –∫–æ–º–ø–∞–Ω–∏–∏...">
        </div>
        <div id="contacts-list" class="list-container"></div>
        <button class="add-button" id="show-add-contact">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç</button>
    </div>

    <!-- –†–∞–∑–¥–µ–ª –°–¥–µ–ª–∫–∏ -->
    <div id="deals" class="section">
        <div class="search-box">
            <input type="text" id="search-deals" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é...">
        </div>
        <div id="deals-list" class="list-container"></div>
        <button class="add-button" id="show-add-deal">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–¥–µ–ª–∫—É</button>
    </div>

    <!-- –†–∞–∑–¥–µ–ª –ó–∞–º–µ—Ç–∫–∏ -->
    <div id="notes" class="section">
        <div class="search-box">
            <input type="text" id="search-notes" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É...">
        </div>
        <div id="notes-list" class="list-container"></div>
        <button class="add-button" id="show-add-note">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
    </div>

    <div class="footer-note">
        ‚ú® –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ü–æ–∑–∂–µ –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–µ—Ä.
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ) -->
<div id="modal" class="modal">
    <div class="modal-content">
        <h3 id="modal-title">–î–æ–±–∞–≤–∏—Ç—å</h3>
        <div id="modal-fields"></div>
        <div class="modal-actions">
            <button id="modal-cancel">–û—Ç–º–µ–Ω–∞</button>
            <button class="primary" id="modal-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>

<script>
    (function() {
        // ------ –•—Ä–∞–Ω–∏–ª–∏—â–µ ------
        const STORAGE_KEYS = {
            CONTACTS: 'crm_contacts',
            DEALS: 'crm_deals',
            NOTES: 'crm_notes',
            ONBOARDING_DONE: 'crm_onboarding_done'
        };

        class Storage {
            static get(key) {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : [];
            }
            static set(key, value) {
                localStorage.setItem(key, JSON.stringify(value));
            }
        }

        // ------ –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ------
        if (Storage.get(STORAGE_KEYS.CONTACTS).length === 0) {
            Storage.set(STORAGE_KEYS.CONTACTS, [
                { id: Date.now() + 1, name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', company: '–û–û–û "–†–æ–º–∞—à–∫–∞"', phone: '+7 999 123-45-67', email: 'ivan@example.com' },
                { id: Date.now() + 2, name: '–û–ª—å–≥–∞ –°–º–∏—Ä–Ω–æ–≤–∞', company: '–ò–ü –°–º–∏—Ä–Ω–æ–≤–∞', phone: '+7 999 765-43-21', email: 'olga@example.com' }
            ]);
        }
        if (Storage.get(STORAGE_KEYS.DEALS).length === 0) {
            Storage.set(STORAGE_KEYS.DEALS, [
                { id: Date.now() + 3, title: '–°–∞–π—Ç –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞', value: 150000, stage: '–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã' },
                { id: Date.now() + 4, title: '–ü–æ—Å—Ç–∞–≤–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', value: 320000, stage: '–û—Ü–µ–Ω–∫–∞' }
            ]);
        }
        if (Storage.get(STORAGE_KEYS.NOTES).length === 0) {
            Storage.set(STORAGE_KEYS.NOTES, [
                { id: Date.now() + 5, title: '–ò–¥–µ—è', content: '–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Telegram' },
                { id: Date.now() + 6, title: '–í—Å—Ç—Ä–µ—á–∞', content: '–û–±—Å—É–¥–∏—Ç—å —É—Å–ª–æ–≤–∏—è —Å –ò–≤–∞–Ω–æ–º 25 –º–∞—è' }
            ]);
        }

        // ------ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ------
        let currentSection = 'dashboard'; // –∏–ª–∏ 'contacts', 'deals', 'notes'
        let editingId = null; // –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        let searchTerms = {
            contacts: '',
            deals: '',
            notes: ''
        };

        // ------ –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ------
        function generateId() {
            return Date.now() + Math.floor(Math.random() * 10000);
        }

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ª–∏–º–∏—Ç–µ
        function updatePricingInfo() {
            const contacts = Storage.get(STORAGE_KEYS.CONTACTS);
            const count = contacts.length;
            document.getElementById('contact-counter').innerText = `${count} / 10 –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤`;
            const warning = document.getElementById('limit-warning');
            if (count >= 10) {
                warning.style.display = 'flex';
            } else {
                warning.style.display = 'none';
            }
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É
        function filterItems(items, type) {
            const term = searchTerms[type]?.toLowerCase() || '';
            if (!term) return items;
            if (type === 'contacts') {
                return items.filter(c => 
                    (c.name?.toLowerCase().includes(term) || 
                     c.company?.toLowerCase().includes(term) ||
                     c.phone?.includes(term) ||
                     c.email?.toLowerCase().includes(term))
                );
            } else if (type === 'deals') {
                return items.filter(d => 
                    d.title?.toLowerCase().includes(term) ||
                    d.stage?.toLowerCase().includes(term)
                );
            } else if (type === 'notes') {
                return items.filter(n => 
                    n.title?.toLowerCase().includes(term) ||
                    n.content?.toLowerCase().includes(term)
                );
            }
            return items;
        }

        // ------ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ ------
        function renderDashboard() {
            const contacts = Storage.get(STORAGE_KEYS.CONTACTS);
            const deals = Storage.get(STORAGE_KEYS.DEALS);
            const notes = Storage.get(STORAGE_KEYS.NOTES);
            const totalDealsValue = deals.reduce((sum, d) => sum + (d.value || 0), 0);
            const successfulDeals = deals.filter(d => d.stage === '–£—Å–ø–µ—Ö').length;

            const statsHtml = `
                <div style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: space-between;">
                    <div style="background: white; border-radius: 20px; padding: 15px; flex: 1 1 120px;">
                        <div style="font-size: 0.8rem; color: #5f6c80;">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
                        <div style="font-size: 2rem; font-weight: 700;">${contacts.length}</div>
                    </div>
                    <div style="background: white; border-radius: 20px; padding: 15px; flex: 1 1 120px;">
                        <div style="font-size: 0.8rem; color: #5f6c80;">–°–¥–µ–ª–∫–∏</div>
                        <div style="font-size: 2rem; font-weight: 700;">${deals.length}</div>
                    </div>
                    <div style="background: white; border-radius: 20px; padding: 15px; flex: 1 1 120px;">
                        <div style="font-size: 0.8rem; color: #5f6c80;">–ó–∞–º–µ—Ç–∫–∏</div>
                        <div style="font-size: 2rem; font-weight: 700;">${notes.length}</div>
                    </div>
                </div>
                <div style="margin-top: 15px; background: white; border-radius: 20px; padding: 15px;">
                    <div style="margin-bottom: 8px;">üí∞ –°—É–º–º–∞ –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫: <strong>${totalDealsValue.toLocaleString()} ‚ÇΩ</strong></div>
                    <div>‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö —Å–¥–µ–ª–æ–∫: <strong>${successfulDeals}</strong></div>
                </div>
            `;
            document.getElementById('dashboard-stats').innerHTML = statsHtml;

            // –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö/–∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö ‚Äî –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ø–æ–∫–∞–∂–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –∑–∞–º–µ—Ç–∫–∏)
            const recentNotes = [...notes].reverse().slice(0, 3);
            const recentHtml = recentNotes.length ? recentNotes.map(n => `
                <div class="list-item" style="padding: 12px;">
                    <div class="item-info">
                        <h4>${escapeHtml(n.title || '–ë–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞')}</h4>
                        <p>${escapeHtml(n.content || '').substring(0, 50)}...</p>
                    </div>
                </div>
            `).join('') : '<div class="empty-state">–ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π</div>';
            document.getElementById('recent-activity').innerHTML = recentHtml;
        }

        function renderContacts() {
            let contacts = Storage.get(STORAGE_KEYS.CONTACTS);
            contacts = filterItems(contacts, 'contacts');
            const container = document.getElementById('contacts-list');
            if (contacts.length === 0) {
                container.innerHTML = '<div class="empty-state">ü§∑ –ù–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π!</div>';
                return;
            }
            container.innerHTML = contacts.map(contact => `
                <div class="list-item" data-id="${contact.id}">
                    <div class="item-info">
                        <h4>${escapeHtml(contact.name)}</h4>
                        <p>${escapeHtml(contact.company || '‚Äî')}  |  ${escapeHtml(contact.phone || '‚Äî')}  |  ${escapeHtml(contact.email || '‚Äî')}</p>
                    </div>
                    <div class="item-actions">
                        <button class="small edit-contact" data-id="${contact.id}">‚úé</button>
                        <button class="small delete-contact" data-id="${contact.id}">‚úï</button>
                    </div>
                </div>
            `).join('');
        }

        function renderDeals() {
            let deals = Storage.get(STORAGE_KEYS.DEALS);
            deals = filterItems(deals, 'deals');
            const container = document.getElementById('deals-list');
            if (deals.length === 0) {
                container.innerHTML = '<div class="empty-state">üíº –ù–µ—Ç —Å–¥–µ–ª–æ–∫. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é!</div>';
                return;
            }
            container.innerHTML = deals.map(deal => `
                <div class="list-item" data-id="${deal.id}">
                    <div class="item-info">
                        <h4>${escapeHtml(deal.title)}</h4>
                        <p>üí∞ ${deal.value ? Number(deal.value).toLocaleString() + ' ‚ÇΩ' : '—Å—É–º–º–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞'}  |  —ç—Ç–∞–ø: ${escapeHtml(deal.stage)}</p>
                    </div>
                    <div class="item-actions">
                        <button class="small edit-deal" data-id="${deal.id}">‚úé</button>
                        <button class="small delete-deal" data-id="${deal.id}">‚úï</button>
                    </div>
                </div>
            `).join('');
        }

        function renderNotes() {
            let notes = Storage.get(STORAGE_KEYS.NOTES);
            notes = filterItems(notes, 'notes');
            const container = document.getElementById('notes-list');
            if (notes.length === 0) {
                container.innerHTML = '<div class="empty-state">üìù –ù–µ—Ç –∑–∞–º–µ—Ç–æ–∫. –î–æ–±–∞–≤—å—Ç–µ!</div>';
                return;
            }
            container.innerHTML = notes.map(note => `
                <div class="list-item" data-id="${note.id}">
                    <div class="item-info">
                        <h4>${escapeHtml(note.title || '–ë–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞')}</h4>
                        <p>${escapeHtml(note.content || '').substring(0, 60)}${note.content?.length > 60 ? '‚Ä¶' : ''}</p>
                    </div>
                    <div class="item-actions">
                        <button class="small edit-note" data-id="${note.id}">‚úé</button>
                        <button class="small delete-note" data-id="${note.id}">‚úï</button>
                    </div>
                </div>
            `).join('');
        }

        function renderAll() {
            renderDashboard();
            renderContacts();
            renderDeals();
            renderNotes();
            updatePricingInfo();
        }

        // ------ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ------
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalFields = document.getElementById('modal-fields');
        const modalSave = document.getElementById('modal-save');
        const modalCancel = document.getElementById('modal-cancel');

        function openModal(type, editData = null) {
            editingId = editData ? editData.id : null;
            let fieldsHtml = '';
            if (type === 'contact') {
                modalTitle.innerText = editData ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç' : '–ù–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç';
                fieldsHtml = `
                    <input type="text" id="modal-contact-name" placeholder="–ò–º—è *" value="${escapeHtml(editData?.name || '')}">
                    <input type="text" id="modal-contact-company" placeholder="–ö–æ–º–ø–∞–Ω–∏—è" value="${escapeHtml(editData?.company || '')}">
                    <input type="tel" id="modal-contact-phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" value="${escapeHtml(editData?.phone || '')}">
                    <input type="email" id="modal-contact-email" placeholder="Email" value="${escapeHtml(editData?.email || '')}">
                `;
            } else if (type === 'deal') {
                modalTitle.innerText = editData ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–¥–µ–ª–∫—É' : '–ù–æ–≤–∞—è —Å–¥–µ–ª–∫–∞';
                const stages = ['–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã', '–û—Ü–µ–Ω–∫–∞', '–£—Å–ø–µ—Ö'];
                const options = stages.map(s => `<option value="${s}" ${editData?.stage === s ? 'selected' : ''}>${s}</option>`).join('');
                fieldsHtml = `
                    <input type="text" id="modal-deal-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏ *" value="${escapeHtml(editData?.title || '')}">
                    <input type="number" id="modal-deal-value" placeholder="–°—É–º–º–∞" value="${editData?.value || ''}">
                    <select id="modal-deal-stage">${options}</select>
                `;
            } else if (type === 'note') {
                modalTitle.innerText = editData ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–º–µ—Ç–∫—É' : '–ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞';
                fieldsHtml = `
                    <input type="text" id="modal-note-title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" value="${escapeHtml(editData?.title || '')}">
                    <textarea id="modal-note-content" placeholder="–¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏">${escapeHtml(editData?.content || '')}</textarea>
                `;
            }
            modalFields.innerHTML = fieldsHtml;
            modal.classList.add('active');
            // –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º —Ç–∏–ø –∫ –∫–Ω–æ–ø–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            modalSave.dataset.type = type;
        }

        function closeModal() {
            modal.classList.remove('active');
            editingId = null;
        }

        modalCancel.addEventListener('click', closeModal);

        modalSave.addEventListener('click', () => {
            const type = modalSave.dataset.type;
            if (type === 'contact') {
                const name = document.getElementById('modal-contact-name')?.value.trim();
                if (!name) { alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è'); return; }
                const contacts = Storage.get(STORAGE_KEYS.CONTACTS);
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞
                if (!editingId && contacts.length >= 10) {
                    alert('–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–∏–º–∏—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (10) –∏—Å—á–µ—Ä–ø–∞–Ω. –£–¥–∞–ª–∏—Ç–µ –ª–∏—à–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ PRO.');
                    closeModal();
                    return;
                }
                const newContact = {
                    id: editingId || generateId(),
                    name,
                    company: document.getElementById('modal-contact-company')?.value.trim() || '',
                    phone: document.getElementById('modal-contact-phone')?.value.trim() || '',
                    email: document.getElementById('modal-contact-email')?.value.trim() || ''
                };
                if (editingId) {
                    const index = contacts.findIndex(c => c.id === editingId);
                    if (index !== -1) contacts[index] = newContact;
                } else {
                    contacts.push(newContact);
                }
                Storage.set(STORAGE_KEYS.CONTACTS, contacts);
                renderContacts();
                updatePricingInfo();
                renderDashboard();
            } else if (type === 'deal') {
                const title = document.getElementById('modal-deal-title')?.value.trim();
                if (!title) { alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏'); return; }
                const deals = Storage.get(STORAGE_KEYS.DEALS);
                const newDeal = {
                    id: editingId || generateId(),
                    title,
                    value: parseFloat(document.getElementById('modal-deal-value')?.value) || 0,
                    stage: document.getElementById('modal-deal-stage')?.value || '–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã'
                };
                if (editingId) {
                    const index = deals.findIndex(d => d.id === editingId);
                    if (index !== -1) deals[index] = newDeal;
                } else {
                    deals.push(newDeal);
                }
                Storage.set(STORAGE_KEYS.DEALS, deals);
                renderDeals();
                renderDashboard();
            } else if (type === 'note') {
                const title = document.getElementById('modal-note-title')?.value.trim() || '';
                const content = document.getElementById('modal-note-content')?.value.trim() || '';
                if (!title && !content) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø–æ–ª–µ'); return; }
                const notes = Storage.get(STORAGE_KEYS.NOTES);
                const newNote = {
                    id: editingId || generateId(),
                    title,
                    content
                };
                if (editingId) {
                    const index = notes.findIndex(n => n.id === editingId);
                    if (index !== -1) notes[index] = newNote;
                } else {
                    notes.push(newNote);
                }
                Storage.set(STORAGE_KEYS.NOTES, notes);
                renderNotes();
                renderDashboard();
            }
            closeModal();
        });

        // ------ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ "–î–æ–±–∞–≤–∏—Ç—å" ------
        document.getElementById('show-add-contact').addEventListener('click', () => openModal('contact'));
        document.getElementById('show-add-deal').addEventListener('click', () => openModal('deal'));
        document.getElementById('show-add-note').addEventListener('click', () => openModal('note'));

        // ------ –£–¥–∞–ª–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª–∫—É ------
        document.addEventListener('click', (e) => {
            // –£–¥–∞–ª–µ–Ω–∏–µ
            if (e.target.classList.contains('delete-contact') ||
                e.target.classList.contains('delete-deal') ||
                e.target.classList.contains('delete-note')) {
                if (!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) return;
                const id = Number(e.target.dataset.id);
                if (e.target.classList.contains('delete-contact')) {
                    let contacts = Storage.get(STORAGE_KEYS.CONTACTS);
                    contacts = contacts.filter(c => c.id !== id);
                    Storage.set(STORAGE_KEYS.CONTACTS, contacts);
                    renderContacts();
                    updatePricingInfo();
                    renderDashboard();
                } else if (e.target.classList.contains('delete-deal')) {
                    let deals = Storage.get(STORAGE_KEYS.DEALS);
                    deals = deals.filter(d => d.id !== id);
                    Storage.set(STORAGE_KEYS.DEALS, deals);
                    renderDeals();
                    renderDashboard();
                } else if (e.target.classList.contains('delete-note')) {
                    let notes = Storage.get(STORAGE_KEYS.NOTES);
                    notes = notes.filter(n => n.id !== id);
                    Storage.set(STORAGE_KEYS.NOTES, notes);
                    renderNotes();
                    renderDashboard();
                }
            }

            // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏)
            if (e.target.classList.contains('edit-contact')) {
                const id = Number(e.target.dataset.id);
                const contacts = Storage.get(STORAGE_KEYS.CONTACTS);
                const contact = contacts.find(c => c.id === id);
                if (contact) openModal('contact', contact);
            }
            if (e.target.classList.contains('edit-deal')) {
                const id = Number(e.target.dataset.id);
                const deals = Storage.get(STORAGE_KEYS.DEALS);
                const deal = deals.find(d => d.id === id);
                if (deal) openModal('deal', deal);
            }
            if (e.target.classList.contains('edit-note')) {
                const id = Number(e.target.dataset.id);
                const notes = Storage.get(STORAGE_KEYS.NOTES);
                const note = notes.find(n => n.id === id);
                if (note) openModal('note', note);
            }
        });

        // ------ –ü–æ–∏—Å–∫ ------
        document.getElementById('search-contacts')?.addEventListener('input', (e) => {
            searchTerms.contacts = e.target.value;
            renderContacts();
        });
        document.getElementById('search-deals')?.addEventListener('input', (e) => {
            searchTerms.deals = e.target.value;
            renderDeals();
        });
        document.getElementById('search-notes')?.addEventListener('input', (e) => {
            searchTerms.notes = e.target.value;
            renderNotes();
        });

        // ------ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ ------
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const targetId = tab.dataset.tab;
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(targetId).classList.add('active');
                currentSection = targetId;
                // –ï—Å–ª–∏ –¥–∞—à–±–æ—Ä–¥ ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                if (targetId === 'dashboard') renderDashboard();
            });
        });

        // ------ –û–Ω–±–æ—Ä–¥–∏–Ω–≥ ------
        const onboarding = document.getElementById('onboarding-message');
        const closeOnboarding = document.getElementById('close-onboarding');
        if (!Storage.get(STORAGE_KEYS.ONBOARDING_DONE)) {
            onboarding.style.display = 'flex';
        } else {
            onboarding.style.display = 'none';
        }
        closeOnboarding.addEventListener('click', () => {
            onboarding.style.display = 'none';
            Storage.set(STORAGE_KEYS.ONBOARDING_DONE, true);
        });

        // ------ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ------
        renderAll();
    })();
</script>
</body>
</html>
