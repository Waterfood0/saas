<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Simple CRM ‚Äî —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
        }

        /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ (–æ—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ) */
        :root {
            --bg-gradient-start: #0f1217;
            --bg-gradient-end: #1a1f2a;
            --surface: #1e2430;
            --surface-light: #2a3140;
            --text-primary: #eef2f6;
            --text-secondary: #9aa4b8;
            --text-tertiary: #6f7a8f;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --border: #2d3545;
            --card-bg: #242b38;
            --warning: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
        }

        body {
            background: linear-gradient(145deg, var(--bg-gradient-start), var(--bg-gradient-end));
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            color: var(--text-primary);
        }

        .app {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ */
        @media (max-width: 768px) {
            body { padding: 8px; }
        }

        /* –®–∞–ø–∫–∞ */
        .header {
            background: var(--surface);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 32px;
            padding: 16px 24px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .pricing-badge {
            background: var(--surface-light);
            border-radius: 40px;
            padding: 12px 20px;
            display: flex;
            gap: 20px;
            align-items: center;
            border: 1px solid var(--border);
        }

        .plan-tag {
            padding: 6px 16px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .plan-tag.free {
            background: var(--surface);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .plan-tag.pro {
            background: var(--accent);
            color: white;
        }

        .counter {
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* –û–±—É—á–µ–Ω–∏–µ (—Ç—É—Ä) —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ */
        .tour-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .tour-card {
            background: var(--surface);
            border-radius: 48px;
            max-width: 450px;
            width: 90%;
            padding: 32px;
            text-align: center;
            border: 1px solid var(--border);
            box-shadow: 0 30px 60px rgba(0,0,0,0.5);
            animation: slideUp 0.3s ease;
        }

        .tour-icon {
            font-size: 56px;
            margin-bottom: 16px;
        }

        .tour-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .tour-desc {
            color: var(--text-secondary);
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .tour-features {
            background: var(--card-bg);
            border-radius: 32px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
            border: 1px solid var(--border);
        }

        .tour-features p {
            margin: 12px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-primary);
        }

        .tour-button {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 60px;
            padding: 18px 32px;
            font-weight: 600;
            font-size: 1.1rem;
            width: 100%;
            cursor: pointer;
            transition: 0.2s;
        }

        .tour-button:hover {
            background: var(--accent-hover);
            transform: scale(1.02);
        }

        /* –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ (–æ–±—É—á–µ–Ω–∏–µ) */
        .hint-popup {
            position: fixed;
            background: var(--surface);
            border: 1px solid var(--accent);
            border-radius: 40px;
            padding: 16px 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4), 0 0 0 4px rgba(59,130,246,0.2);
            z-index: 1500;
            max-width: 300px;
            pointer-events: none;
            color: var(--text-primary);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .hint-arrow {
            font-size: 24px;
            color: var(--accent);
        }

        .hint-highlight {
            position: relative;
            z-index: 1499;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(59,130,246,0.4); }
            70% { box-shadow: 0 0 0 10px rgba(59,130,246,0); }
            100% { box-shadow: 0 0 0 0 rgba(59,130,246,0); }
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .tabs-container {
            background: var(--surface);
            border-radius: 32px;
            padding: 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border: 1px solid var(--border);
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: var(--surface-light);
            padding: 6px;
            border-radius: 60px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1 1 auto;
            text-align: center;
            padding: 14px 16px;
            font-weight: 600;
            border-radius: 60px;
            background: transparent;
            border: none;
            font-size: 1rem;
            color: var(--text-secondary);
            transition: 0.2s;
            cursor: pointer;
            white-space: nowrap;
        }

        .tab.active {
            background: var(--accent);
            color: white;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 28px;
            padding: 20px 16px;
            text-align: center;
            border: 1px solid var(--border);
            transition: 0.2s;
        }

        .stat-card:hover {
            border-color: var(--accent);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .dashboard-card {
            background: var(--card-bg);
            border-radius: 28px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .card-title {
            font-weight: 600;
            font-size: 1.2rem;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
        }

        .reminder-item {
            background: var(--surface);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--accent);
        }

        .reminder-item.urgent {
            border-left-color: var(--warning);
        }

        .reminder-info h4 {
            font-size: 1rem;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .reminder-date {
            font-size: 0.85rem;
            color: var(--text-tertiary);
        }

        /* –ü–æ–∏—Å–∫ */
        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 16px 20px;
            border: 1px solid var(--border);
            border-radius: 60px;
            font-size: 1rem;
            background: var(--surface);
            color: var(--text-primary);
        }

        .search-box input::placeholder {
            color: var(--text-tertiary);
        }

        /* –°–ø–∏—Å–∫–∏ */
        .list-container {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 4px;
            margin-bottom: 20px;
        }

        .item-card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 18px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            transition: 0.2s;
        }

        .item-card:hover {
            border-color: var(--accent);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .item-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .item-details {
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .item-details p {
            margin: 4px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .badge {
            background: var(--surface-light);
            padding: 4px 12px;
            border-radius: 40px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .btn {
            padding: 10px 20px;
            border-radius: 40px;
            border: none;
            font-weight: 500;
            font-size: 0.95rem;
            cursor: pointer;
            transition: 0.2s;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .btn:hover {
            border-color: var(--accent);
            background: var(--surface-light);
        }

        .btn-primary {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .add-button {
            width: 100%;
            padding: 16px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 60px;
            font-weight: 600;
            font-size: 1rem;
            margin: 10px 0;
            cursor: pointer;
            transition: 0.2s;
        }

        .add-button:hover {
            background: var(--accent-hover);
            transform: scale(1.01);
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 16px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--surface);
            border-radius: 48px;
            max-width: 500px;
            width: 100%;
            padding: 32px;
            border: 1px solid var(--border);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            font-size: 1.8rem;
            color: var(--text-primary);
            margin-bottom: 24px;
        }

        .modal-content input,
        .modal-content select,
        .modal-content textarea {
            width: 100%;
            padding: 16px 18px;
            border: 1px solid var(--border);
            border-radius: 30px;
            font-size: 1rem;
            margin-bottom: 16px;
            background: var(--surface-light);
            color: var(--text-primary);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .modal-actions button {
            flex: 1;
            padding: 16px;
            border-radius: 40px;
            font-weight: 600;
        }

        /* –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            background: var(--card-bg);
            border-radius: 32px;
            color: var(--text-tertiary);
            border: 1px solid var(--border);
        }

        /* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ */
        .integrations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }

        .integration-card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 20px 8px;
            text-align: center;
            font-weight: 500;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        /* –ü–æ–¥—Å–∫–∞–∑–∫–∏ –≤ —Ä–∞–∑–¥–µ–ª–∞—Ö */
        .section-hint {
            background: var(--surface-light);
            border-radius: 20px;
            padding: 16px;
            margin: 20px 0 10px;
            border-left: 4px solid var(--accent);
            color: var(--text-secondary);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* –ü–æ–¥–≤–∞–ª */
        .footer {
            text-align: center;
            margin-top: 20px;
            color: var(--text-tertiary);
            font-size: 0.85rem;
        }

        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--surface);
            border-radius: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 8px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }
    </style>
</head>
<body>
<div class="app">
    <!-- –®–∞–ø–∫–∞ -->
    <div class="header">
        <div class="logo">
            <h1>‚ú® Simple CRM</h1>
        </div>
        <div class="pricing-badge">
            <span class="plan-tag free">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
            <span class="plan-tag pro">PRO 990 ‚ÇΩ/–º–µ—Å</span>
            <span class="counter" id="contact-counter">0 / 10 –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤</span>
        </div>
    </div>

    <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ª–∏–º–∏—Ç–µ -->
    <div id="limit-warning" class="section-hint" style="display: none; background: #2d2620; border-left-color: var(--warning);">
        <span>‚ö†Ô∏è</span>
        <span>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–∏–º–∏—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (10) –∏—Å—á–µ—Ä–ø–∞–Ω. –£–¥–∞–ª–∏—Ç–µ –ª–∏—à–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ PRO.</span>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab active" data-tab="dashboard">üè† –ì–ª–∞–≤–Ω–∞—è</button>
            <button class="tab" data-tab="contacts">üë• –ö–æ–Ω—Ç–∞–∫—Ç—ã</button>
            <button class="tab" data-tab="deals">üíº –°–¥–µ–ª–∫–∏</button>
            <button class="tab" data-tab="tasks">‚úÖ –ó–∞–¥–∞—á–∏</button>
            <button class="tab" data-tab="comments">üí¨ –û–±—Å—É–∂–¥–µ–Ω–∏—è</button>
            <button class="tab" data-tab="integrations">üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</button>
        </div>

        <!-- –ì–õ–ê–í–ù–ê–Ø -->
        <div id="dashboard" class="section active">
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-value" id="stat-contacts">0</div><div class="stat-label">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div></div>
                <div class="stat-card"><div class="stat-value" id="stat-deals">0</div><div class="stat-label">–°–¥–µ–ª–∫–∏</div></div>
                <div class="stat-card"><div class="stat-value" id="stat-tasks">0</div><div class="stat-label">–ó–∞–¥–∞—á–∏</div></div>
                <div class="stat-card"><div class="stat-value" id="stat-sum">0‚ÇΩ</div><div class="stat-label">–°—É–º–º–∞ —Å–¥–µ–ª–æ–∫</div></div>
            </div>

            <div class="dashboard-card">
                <div class="card-title">‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–ª–∫–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</div>
                <div id="today-reminders"></div>
                <button class="btn btn-primary" id="check-reminders" style="width:100%; margin-top:12px;">üîî –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</button>
            </div>

            <div class="dashboard-card">
                <div class="card-title">üí¨ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è</div>
                <div id="recent-comments"></div>
            </div>
        </div>

        <!-- –ö–û–ù–¢–ê–ö–¢–´ -->
        <div id="contacts" class="section">
            <div class="search-box"><input type="text" id="search-contacts" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, –∫–æ–º–ø–∞–Ω–∏–∏..."></div>
            <div id="contacts-list" class="list-container"></div>
            <button class="add-button" id="show-add-contact">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç</button>
            <div class="section-hint"><span>üë§</span><span><b>–ö–æ–Ω—Ç–∞–∫—Ç—ã</b> ‚Äî –≤–∞—à–∞ –±–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤. –î–æ–±–∞–≤–ª—è–π—Ç–µ –∏–º—è, –∫–æ–º–ø–∞–Ω–∏—é, —Ç–µ–ª–µ—Ñ–æ–Ω –∏ email.</span></div>
        </div>

        <!-- –°–î–ï–õ–ö–ò -->
        <div id="deals" class="section">
            <div class="search-box"><input type="text" id="search-deals" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ —Å–¥–µ–ª–∫–∞–º..."></div>
            <div id="deals-list" class="list-container"></div>
            <button class="add-button" id="show-add-deal">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–¥–µ–ª–∫—É</button>
            <div class="section-hint"><span>üíº</span><span><b>–°–¥–µ–ª–∫–∞</b> ‚Äî —ç—Ç–æ –ø—Ä–æ–¥–∞–∂–∞. –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, —Å—É–º–º—É, —ç—Ç–∞–ø –∏ –ø—Ä–∏–≤—è–∂–∏—Ç–µ –∫ –∫–æ–Ω—Ç–∞–∫—Ç—É.</span></div>
        </div>

        <!-- –ó–ê–î–ê–ß–ò -->
        <div id="tasks" class="section">
            <div class="search-box"><input type="text" id="search-tasks" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∑–∞–¥–∞—á–∞–º..."></div>
            <div id="tasks-list" class="list-container"></div>
            <button class="add-button" id="show-add-task">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
            <div class="section-hint"><span>‚úÖ</span><span><b>–ó–∞–¥–∞—á–∏</b> ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å: –ø–æ–∑–≤–æ–Ω–∏—Ç—å, –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã.</span></div>
        </div>

        <!-- –û–ë–°–£–ñ–î–ï–ù–ò–Ø -->
        <div id="comments" class="section">
            <div class="search-box"><input type="text" id="search-comments" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º..."></div>
            <div id="comments-list" class="list-container"></div>
            <div style="background:var(--card-bg); border-radius:32px; padding:20px; margin:20px 0;">
                <select id="comment-deal-select" style="width:100%; padding:16px; border-radius:40px; margin-bottom:16px; background:var(--surface); color:var(--text-primary); border:1px solid var(--border);">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–¥–µ–ª–∫—É</option>
                </select>
                <input type="text" id="comment-text" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." style="width:100%; padding:16px; border-radius:40px; margin-bottom:16px; background:var(--surface); color:var(--text-primary); border:1px solid var(--border);">
                <button class="btn btn-primary" id="add-comment-btn" style="width:100%;">üí¨ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
            </div>
            <div class="section-hint"><span>üí¨</span><span><b>–û–±—Å—É–∂–¥–µ–Ω–∏—è</b> ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —á–∞—Ç –ø–æ —Å–¥–µ–ª–∫–∞–º. –ü–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–¥–µ–ª–∫–µ.</span></div>
        </div>

        <!-- –ò–ù–¢–ï–ì–†–ê–¶–ò–ò -->
        <div id="integrations" class="section">
            <div class="integrations-grid">
                <div class="integration-card">üìß Email</div>
                <div class="integration-card">üìû –¢–µ–ª–µ—Ñ–æ–Ω–∏—è</div>
                <div class="integration-card">üì± WhatsApp</div>
                <div class="integration-card">‚úàÔ∏è Telegram</div>
                <div class="integration-card">üìä Excel</div>
                <div class="integration-card">üîå API</div>
            </div>
            <div class="section-hint"><span>üîå</span><span><b>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</b> ‚Äî —Å–∫–æ—Ä–æ –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –ø–æ—á—Ç—É, –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã –∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∏—é.</span></div>
        </div>
    </div>

    <div class="footer">
        ‚ú® –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π —Ä–∞–∑–¥–µ–ª, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div id="modal" class="modal">
    <div class="modal-content">
        <h2 id="modal-title">–î–æ–±–∞–≤–∏—Ç—å</h2>
        <div id="modal-fields"></div>
        <div class="modal-actions">
            <button class="btn" id="modal-cancel">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn btn-primary" id="modal-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- –û–±—É—á–µ–Ω–∏–µ (—Ç—É—Ä) —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ -->
<div id="tour-overlay" class="tour-overlay" style="display: none;">
    <div class="tour-card">
        <div class="tour-icon">üëã</div>
        <div class="tour-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>
        <div class="tour-desc">–°–µ–π—á–∞—Å –º—ã –±—ã—Å—Ç—Ä–æ –ø–æ–∫–∞–∂–µ–º, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç CRM. –ù–∞–∂–∏–º–∞–π—Ç–µ "–î–∞–ª–µ–µ", —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏.</div>
        <div class="tour-features" id="tour-features">
            <p>üè† <b>–ì–ª–∞–≤–Ω–∞—è</b> ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–ª–∫–∏</p>
            <p>üë• <b>–ö–æ–Ω—Ç–∞–∫—Ç—ã</b> ‚Äî –±–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
            <p>üíº <b>–°–¥–µ–ª–∫–∏</b> ‚Äî –≤–∞—à–∏ –ø—Ä–æ–¥–∞–∂–∏</p>
            <p>‚úÖ <b>–ó–∞–¥–∞—á–∏</b> ‚Äî —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å</p>
            <p>üí¨ <b>–û–±—Å—É–∂–¥–µ–Ω–∏—è</b> ‚Äî —á–∞—Ç –ø–æ —Å–¥–µ–ª–∫–∞–º</p>
        </div>
        <button class="tour-button" id="start-tour">üöÄ –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ</button>
    </div>
</div>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫ -->
<div id="hint-container"></div>

<script>
    (function() {
        // ========== –•—Ä–∞–Ω–∏–ª–∏—â–µ ==========
        const STORAGE_KEYS = {
            CONTACTS: 'crm_dark_contacts',
            DEALS: 'crm_dark_deals',
            TASKS: 'crm_dark_tasks',
            COMMENTS: 'crm_dark_comments',
            TOUR_DONE: 'crm_dark_tour_done'
        };

        class Storage {
            static get(key) { return JSON.parse(localStorage.getItem(key)) || []; }
            static set(key, val) { localStorage.setItem(key, JSON.stringify(val)); }
        }

        // ========== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö ==========
        if (Storage.get(STORAGE_KEYS.CONTACTS).length === 0) {
            Storage.set(STORAGE_KEYS.CONTACTS, [
                { id: 1001, name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', company: '–û–û–û "–†–æ–º–∞—à–∫–∞"', phone: '+7 999 123-45-67', email: 'ivan@example.com' },
                { id: 1002, name: '–û–ª—å–≥–∞ –°–º–∏—Ä–Ω–æ–≤–∞', company: '–ò–ü –°–º–∏—Ä–Ω–æ–≤–∞', phone: '+7 999 765-43-21', email: 'olga@example.com' }
            ]);
        }
        if (Storage.get(STORAGE_KEYS.DEALS).length === 0) {
            Storage.set(STORAGE_KEYS.DEALS, [
                { id: 2001, title: '–°–∞–π—Ç –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞', value: 150000, stage: '–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã', contactId: 1001 },
                { id: 2002, title: '–ü–æ—Å—Ç–∞–≤–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', value: 320000, stage: '–û—Ü–µ–Ω–∫–∞', contactId: 1002 }
            ]);
        }
        const today = new Date().toISOString().split('T')[0];
        const tomorrow = new Date(Date.now() + 86400000).toISOString().split('T')[0];
        if (Storage.get(STORAGE_KEYS.TASKS).length === 0) {
            Storage.set(STORAGE_KEYS.TASKS, [
                { id: 3001, title: '–ü–æ–∑–≤–æ–Ω–∏—Ç—å –ò–≤–∞–Ω—É', dueDate: today, completed: false, dealId: 2001 },
                { id: 3002, title: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ö–ü', dueDate: tomorrow, completed: false, dealId: 2002 }
            ]);
        }
        if (Storage.get(STORAGE_KEYS.COMMENTS).length === 0) {
            Storage.set(STORAGE_KEYS.COMMENTS, [
                { id: 4001, dealId: 2001, text: '–ö–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å–∏—Ç —Å–∫–∏–¥–∫—É 10%', author: '–ú–µ–Ω–µ–¥–∂–µ—Ä', time: new Date().toISOString() },
                { id: 4002, dealId: 2002, text: '–ñ–¥—ë–º —Ä–µ—à–µ–Ω–∏–µ –¥–æ –ø—è—Ç–Ω–∏—Ü—ã', author: '–ú–µ–Ω–µ–¥–∂–µ—Ä', time: new Date().toISOString() }
            ]);
        }

        // ========== –°–æ—Å—Ç–æ—è–Ω–∏–µ ==========
        let searchTerms = { contacts: '', deals: '', tasks: '', comments: '' };
        let editingId = null;
        let currentUser = '–ú–µ–Ω–µ–¥–∂–µ—Ä';
        let tourStep = 0;
        let tourActive = false;

        // ========== –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ ==========
        function generateId() { return Date.now() + Math.floor(Math.random() * 10000); }
        function escape(s) { return s ? String(s).replace(/[&<>"]/g, function(m) { return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]; }) : ''; }
        function formatDate(d) { return d ? new Date(d).toLocaleDateString('ru-RU') : ''; }
        function isToday(d) { return d === new Date().toISOString().split('T')[0]; }

        // ========== –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ==========
        function updateCounters() {
            const contacts = Storage.get(STORAGE_KEYS.CONTACTS);
            document.getElementById('contact-counter').innerText = `${contacts.length} / 10 –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤`;
            document.getElementById('limit-warning').style.display = contacts.length >= 10 ? 'flex' : 'none';
        }

        function renderDashboard() {
            const contacts = Storage.get(STORAGE_KEYS.CONTACTS);
            const deals = Storage.get(STORAGE_KEYS.DEALS);
            const tasks = Storage.get(STORAGE_KEYS.TASKS);
            const comments = Storage.get(STORAGE_KEYS.COMMENTS);

            document.getElementById('stat-contacts').innerText = contacts.length;
            document.getElementById('stat-deals').innerText = deals.length;
            document.getElementById('stat-tasks').innerText = tasks.length;
            const sum = deals.reduce((s,d) => s + (d.value||0), 0);
            document.getElementById('stat-sum').innerText = sum.toLocaleString() + '‚ÇΩ';

            const todayTasks = tasks.filter(t => !t.completed && isToday(t.dueDate));
            const remEl = document.getElementById('today-reminders');
            if (todayTasks.length === 0) remEl.innerHTML = '<div class="empty-state">‚úÖ –ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–¥–∞—á –Ω–µ—Ç</div>';
            else {
                remEl.innerHTML = todayTasks.map(t => `
                    <div class="reminder-item ${isToday(t.dueDate) ? 'urgent' : ''}">
                        <div><h4>${escape(t.title)}</h4><div class="reminder-date">${formatDate(t.dueDate)}</div></div>
                        <button class="btn btn-small toggle-task" data-id="${t.id}">‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                    </div>`).join('');
            }

            const recent = comments.slice(-3).reverse();
            const commEl = document.getElementById('recent-comments');
            if (recent.length === 0) commEl.innerHTML = '<div class="empty-state">üí¨ –ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>';
            else {
                commEl.innerHTML = recent.map(c => {
                    const deal = deals.find(d => d.id === c.dealId);
                    return `<div class="item-card"><b>${escape(c.author)}</b>: ${escape(c.text)}<br><small>–ø–æ —Å–¥–µ–ª–∫–µ ¬´${deal ? escape(deal.title) : '‚Äî'}¬ª ‚Ä¢ ${new Date(c.time).toLocaleString()}</small></div>`;
                }).join('');
            }
        }

        function renderContacts() {
            let items = Storage.get(STORAGE_KEYS.CONTACTS);
            const term = searchTerms.contacts.toLowerCase();
            if (term) items = items.filter(c => c.name?.toLowerCase().includes(term) || c.company?.toLowerCase().includes(term));
            const html = items.length ? items.map(c => `
                <div class="item-card">
                    <div class="item-header"><h3>${escape(c.name)}</h3><div><button class="btn btn-small edit-contact" data-id="${c.id}">‚úé</button> <button class="btn btn-small delete-contact" data-id="${c.id}">‚úï</button></div></div>
                    <div class="item-details">üè¢ ${escape(c.company||'‚Äî')}<br>üìû ${escape(c.phone||'‚Äî')}<br>‚úâÔ∏è ${escape(c.email||'‚Äî')}</div>
                </div>`).join('') : '<div class="empty-state">ü§∑ –ù–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤</div>';
            document.getElementById('contacts-list').innerHTML = html;
        }

        function renderDeals() {
            let items = Storage.get(STORAGE_KEYS.DEALS);
            const contacts = Storage.get(STORAGE_KEYS.CONTACTS);
            const term = searchTerms.deals.toLowerCase();
            if (term) items = items.filter(d => d.title?.toLowerCase().includes(term));
            const html = items.length ? items.map(d => {
                const contact = contacts.find(c => c.id === d.contactId);
                return `<div class="item-card">
                    <div class="item-header"><h3>${escape(d.title)}</h3><div><button class="btn btn-small edit-deal" data-id="${d.id}">‚úé</button> <button class="btn btn-small delete-deal" data-id="${d.id}">‚úï</button></div></div>
                    <div class="item-details">üí∞ ${(d.value||0).toLocaleString()} ‚ÇΩ<br>üìå –≠—Ç–∞–ø: ${escape(d.stage)}<br>üë§ –ö–æ–Ω—Ç–∞–∫—Ç: ${contact ? escape(contact.name) : '‚Äî'}</div>
                </div>`}).join('') : '<div class="empty-state">üíº –ù–µ—Ç —Å–¥–µ–ª–æ–∫</div>';
            document.getElementById('deals-list').innerHTML = html;
        }

        function renderTasks() {
            let items = Storage.get(STORAGE_KEYS.TASKS);
            const deals = Storage.get(STORAGE_KEYS.DEALS);
            const term = searchTerms.tasks.toLowerCase();
            if (term) items = items.filter(t => t.title?.toLowerCase().includes(term));
            const html = items.length ? items.map(t => {
                const deal = deals.find(d => d.id === t.dealId);
                return `<div class="item-card" style="opacity:${t.completed?0.7:1}">
                    <div class="item-header"><h3 style="text-decoration:${t.completed?'line-through':'none'}">${escape(t.title)}</h3>
                        <div><button class="btn btn-small toggle-task" data-id="${t.id}">${t.completed?'‚Ü©Ô∏è':'‚úÖ'}</button>
                        <button class="btn btn-small edit-task" data-id="${t.id}">‚úé</button>
                        <button class="btn btn-small delete-task" data-id="${t.id}">‚úï</button></div>
                    </div>
                    <div class="item-details">üìÖ ${formatDate(t.dueDate)} ${isToday(t.dueDate)?'üîî –°–µ–≥–æ–¥–Ω—è':''}<br>üìå –°–¥–µ–ª–∫–∞: ${deal ? escape(deal.title) : '‚Äî'}</div>
                </div>`}).join('') : '<div class="empty-state">‚úÖ –ù–µ—Ç –∑–∞–¥–∞—á</div>';
            document.getElementById('tasks-list').innerHTML = html;
        }

        function renderComments() {
            let items = Storage.get(STORAGE_KEYS.COMMENTS);
            const deals = Storage.get(STORAGE_KEYS.DEALS);
            const term = searchTerms.comments.toLowerCase();
            if (term) items = items.filter(c => c.text?.toLowerCase().includes(term));
            items.sort((a,b) => new Date(b.time) - new Date(a.time));
            const html = items.length ? items.map(c => {
                const deal = deals.find(d => d.id === c.dealId);
                return `<div class="item-card"><b>${escape(c.author)}</b>: ${escape(c.text)}<br><small>–ø–æ —Å–¥–µ–ª–∫–µ ¬´${deal ? escape(deal.title) : '‚Äî'}¬ª ‚Ä¢ ${new Date(c.time).toLocaleString()}</small></div>`;
            }).join('') : '<div class="empty-state">üí¨ –ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>';
            document.getElementById('comments-list').innerHTML = html;

            const select = document.getElementById('comment-deal-select');
            if (select) select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–¥–µ–ª–∫—É</option>' + deals.map(d => `<option value="${d.id}">${escape(d.title)}</option>`).join('');
        }

        function renderAll() { renderDashboard(); renderContacts(); renderDeals(); renderTasks(); renderComments(); updateCounters(); }

        // ========== –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ==========
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalFields = document.getElementById('modal-fields');
        const modalSave = document.getElementById('modal-save');
        const modalCancel = document.getElementById('modal-cancel');

        function openModal(type, editData = null) {
            editingId = editData ? editData.id : null;
            const contacts = Storage.get(STORAGE_KEYS.CONTACTS);
            const deals = Storage.get(STORAGE_KEYS.DEALS);
            let html = '';
            if (type === 'contact') {
                modalTitle.innerText = editData ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç' : '–ù–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç';
                html = `
                    <input type="text" id="modal-name" placeholder="–ò–º—è *" value="${escape(editData?.name||'')}">
                    <input type="text" id="modal-company" placeholder="–ö–æ–º–ø–∞–Ω–∏—è" value="${escape(editData?.company||'')}">
                    <input type="tel" id="modal-phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" value="${escape(editData?.phone||'')}">
                    <input type="email" id="modal-email" placeholder="Email" value="${escape(editData?.email||'')}">
                `;
            } else if (type === 'deal') {
                modalTitle.innerText = editData ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–¥–µ–ª–∫—É' : '–ù–æ–≤–∞—è —Å–¥–µ–ª–∫–∞';
                const stages = ['–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã','–û—Ü–µ–Ω–∫–∞','–£—Å–ø–µ—Ö','–ü—Ä–æ–≤–∞–ª'];
                const stageOpts = stages.map(s => `<option value="${s}" ${editData?.stage===s?'selected':''}>${s}</option>`).join('');
                const contactOpts = contacts.map(c => `<option value="${c.id}" ${editData?.contactId===c.id?'selected':''}>${escape(c.name)}</option>`).join('');
                html = `
                    <input type="text" id="modal-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ *" value="${escape(editData?.title||'')}">
                    <input type="number" id="modal-value" placeholder="–°—É–º–º–∞" value="${editData?.value||''}">
                    <select id="modal-stage">${stageOpts}</select>
                    <select id="modal-contact">${contactOpts}</select>
                `;
            } else if (type === 'task') {
                modalTitle.innerText = editData ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É' : '–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞';
                const dealOpts = deals.map(d => `<option value="${d.id}" ${editData?.dealId===d.id?'selected':''}>${escape(d.title)}</option>`).join('');
                html = `
                    <input type="text" id="modal-title" placeholder="–ó–∞–¥–∞—á–∞ *" value="${escape(editData?.title||'')}">
                    <input type="date" id="modal-due" value="${editData?.dueDate||''}">
                    <select id="modal-deal">${dealOpts}</select>
                `;
            }
            modalFields.innerHTML = html;
            modal.classList.add('active');
            modalSave.dataset.type = type;
        }

        modalCancel.onclick = () => modal.classList.remove('active');
        modalSave.onclick = () => {
            const type = modalSave.dataset.type;
            if (type === 'contact') {
                const name = document.getElementById('modal-name')?.value.trim();
                if (!name) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
                const contacts = Storage.get(STORAGE_KEYS.CONTACTS);
                if (!editingId && contacts.length >= 10) { alert('–õ–∏–º–∏—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ 10'); return; }
                const newItem = { id: editingId || generateId(), name, company: document.getElementById('modal-company')?.value||'', phone: document.getElementById('modal-phone')?.value||'', email: document.getElementById('modal-email')?.value||'' };
                if (editingId) {
                    const idx = contacts.findIndex(c => c.id === editingId);
                    if (idx>=0) contacts[idx] = newItem;
                } else contacts.push(newItem);
                Storage.set(STORAGE_KEYS.CONTACTS, contacts);
                renderContacts(); renderDashboard(); updateCounters();
            } else if (type === 'deal') {
                const title = document.getElementById('modal-title')?.value.trim();
                if (!title) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ');
                const deals = Storage.get(STORAGE_KEYS.DEALS);
                const newItem = { id: editingId || generateId(), title, value: parseFloat(document.getElementById('modal-value')?.value)||0, stage: document.getElementById('modal-stage')?.value, contactId: parseInt(document.getElementById('modal-contact')?.value)||null };
                if (editingId) {
                    const idx = deals.findIndex(d => d.id === editingId);
                    if (idx>=0) deals[idx] = newItem;
                } else deals.push(newItem);
                Storage.set(STORAGE_KEYS.DEALS, deals);
                renderDeals(); renderDashboard();
            } else if (type === 'task') {
                const title = document.getElementById('modal-title')?.value.trim();
                if (!title) return alert('–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É');
                const tasks = Storage.get(STORAGE_KEYS.TASKS);
                const newItem = { id: editingId || generateId(), title, dueDate: document.getElementById('modal-due')?.value, completed: false, dealId: parseInt(document.getElementById('modal-deal')?.value)||null };
                if (editingId) {
                    const idx = tasks.findIndex(t => t.id === editingId);
                    if (idx>=0) { newItem.completed = tasks[idx].completed; tasks[idx] = newItem; }
                } else tasks.push(newItem);
                Storage.set(STORAGE_KEYS.TASKS, tasks);
                renderTasks(); renderDashboard();
            }
            modal.classList.remove('active');
        };

        // ========== –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ ==========
        const tourOverlay = document.getElementById('tour-overlay');
        const hintContainer = document.getElementById('hint-container');
        
        function showHint(element, text, position = 'bottom') {
            if (!element) return;
            const rect = element.getBoundingClientRect();
            const hint = document.createElement('div');
            hint.className = 'hint-popup';
            hint.innerHTML = `<span class="hint-arrow">üëâ</span><span>${text}</span>`;
            
            let top, left;
            if (position === 'bottom') {
                top = rect.bottom + 10;
                left = rect.left + rect.width/2 - 150;
            } else if (position === 'top') {
                top = rect.top - 70;
                left = rect.left + rect.width/2 - 150;
            } else if (position === 'right') {
                top = rect.top + rect.height/2 - 25;
                left = rect.right + 10;
            }
            
            hint.style.top = top + 'px';
            hint.style.left = left + 'px';
            hintContainer.innerHTML = '';
            hintContainer.appendChild(hint);
            
            element.classList.add('hint-highlight');
            return hint;
        }

        function clearHints() {
            hintContainer.innerHTML = '';
            document.querySelectorAll('.hint-highlight').forEach(el => el.classList.remove('hint-highlight'));
        }

        function startTour() {
            tourOverlay.style.display = 'none';
            tourActive = true;
            tourStep = 0;
            nextTourStep();
        }

        function nextTourStep() {
            clearHints();
            
            const steps = [
                { selector: '.tab[data-tab="dashboard"]', text: 'üè† –ì–ª–∞–≤–Ω–∞—è ‚Äî –∑–¥–µ—Å—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–ª–∫–∏', position: 'bottom' },
                { selector: '.tab[data-tab="contacts"]', text: 'üë• –ö–æ–Ω—Ç–∞–∫—Ç—ã ‚Äî –≤–∞—à–∞ –±–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤', position: 'bottom' },
                { selector: '.tab[data-tab="deals"]', text: 'üíº –°–¥–µ–ª–∫–∏ ‚Äî –ø—Ä–æ–¥–∞–∂–∏ –∏ –≤–æ—Ä–æ–Ω–∫–∞', position: 'bottom' },
                { selector: '.tab[data-tab="tasks"]', text: '‚úÖ –ó–∞–¥–∞—á–∏ ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è', position: 'bottom' },
                { selector: '.tab[data-tab="comments"]', text: 'üí¨ –û–±—Å—É–∂–¥–µ–Ω–∏—è ‚Äî —á–∞—Ç –ø–æ —Å–¥–µ–ª–∫–∞–º', position: 'bottom' },
                { selector: '#show-add-contact', text: '‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç ‚Äî –Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç', position: 'top' },
                { selector: '.edit-contact', text: '‚úé ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å', position: 'right' },
                { selector: '.delete-contact', text: '‚úï ‚Äî —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å', position: 'left' }
            ];
            
            if (tourStep < steps.length) {
                const step = steps[tourStep];
                const element = document.querySelector(step.selector);
                if (element) {
                    showHint(element, step.text, step.position);
                    // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É, –µ—Å–ª–∏ —ç—Ç–æ —Ç–∞–±
                    if (step.selector.includes('tab')) {
                        element.click();
                    }
                    tourStep++;
                    setTimeout(nextTourStep, 3000);
                } else {
                    // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —à–∞–≥
                    tourStep++;
                    setTimeout(nextTourStep, 100);
                }
            } else {
                tourActive = false;
                clearHints();
                alert('üéâ –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—ã –∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è CRM.');
            }
        }

        // ========== –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ==========
        document.getElementById('show-add-contact').onclick = () => openModal('contact');
        document.getElementById('show-add-deal').onclick = () => openModal('deal');
        document.getElementById('show-add-task').onclick = () => openModal('task');

        document.getElementById('add-comment-btn').onclick = () => {
            const dealId = parseInt(document.getElementById('comment-deal-select')?.value);
            const text = document.getElementById('comment-text')?.value.trim();
            if (!dealId || !text) return alert('–í—ã–±–µ—Ä–∏—Ç–µ —Å–¥–µ–ª–∫—É –∏ –Ω–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π');
            const comments = Storage.get(STORAGE_KEYS.COMMENTS);
            comments.push({ id: generateId(), dealId, text, author: currentUser, time: new Date().toISOString() });
            Storage.set(STORAGE_KEYS.COMMENTS, comments);
            document.getElementById('comment-text').value = '';
            renderComments(); renderDashboard();
        };

        document.getElementById('check-reminders').onclick = () => {
            const tasks = Storage.get(STORAGE_KEYS.TASKS);
            const todayTasks = tasks.filter(t => !t.completed && isToday(t.dueDate));
            alert(todayTasks.length ? `üîî –£ –≤–∞—Å ${todayTasks.length} –∑–∞–¥–∞—á –Ω–∞ —Å–µ–≥–æ–¥–Ω—è` : '‚úÖ –ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–¥–∞—á –Ω–µ—Ç');
        };

        document.addEventListener('click', e => {
            const id = Number(e.target.dataset.id);
            if (e.target.classList.contains('delete-contact')) {
                if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç?')) return;
                Storage.set(STORAGE_KEYS.CONTACTS, Storage.get(STORAGE_KEYS.CONTACTS).filter(c => c.id !== id));
                renderContacts(); renderDashboard(); updateCounters();
            } else if (e.target.classList.contains('delete-deal')) {
                if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å–¥–µ–ª–∫—É?')) return;
                Storage.set(STORAGE_KEYS.DEALS, Storage.get(STORAGE_KEYS.DEALS).filter(d => d.id !== id));
                renderDeals(); renderDashboard();
            } else if (e.target.classList.contains('delete-task')) {
                if (!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?')) return;
                Storage.set(STORAGE_KEYS.TASKS, Storage.get(STORAGE_KEYS.TASKS).filter(t => t.id !== id));
                renderTasks(); renderDashboard();
            } else if (e.target.classList.contains('edit-contact')) {
                const item = Storage.get(STORAGE_KEYS.CONTACTS).find(c => c.id === id);
                if (item) openModal('contact', item);
            } else if (e.target.classList.contains('edit-deal')) {
                const item = Storage.get(STORAGE_KEYS.DEALS).find(d => d.id === id);
                if (item) openModal('deal', item);
            } else if (e.target.classList.contains('edit-task')) {
                const item = Storage.get(STORAGE_KEYS.TASKS).find(t => t.id === id);
                if (item) openModal('task', item);
            } else if (e.target.classList.contains('toggle-task')) {
                const tasks = Storage.get(STORAGE_KEYS.TASKS);
                const task = tasks.find(t => t.id === id);
                if (task) { task.completed = !task.completed; Storage.set(STORAGE_KEYS.TASKS, tasks); renderTasks(); renderDashboard(); }
            }
        });

        // –ü–æ–∏—Å–∫
        document.getElementById('search-contacts')?.addEventListener('input', e => { searchTerms.contacts = e.target.value; renderContacts(); });
        document.getElementById('search-deals')?.addEventListener('input', e => { searchTerms.deals = e.target.value; renderDeals(); });
        document.getElementById('search-tasks')?.addEventListener('input', e => { searchTerms.tasks = e.target.value; renderTasks(); });
        document.getElementById('search-comments')?.addEventListener('input', e => { searchTerms.comments = e.target.value; renderComments(); });

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // ========== –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è ==========
        if (!localStorage.getItem(STORAGE_KEYS.TOUR_DONE)) {
            tourOverlay.style.display = 'flex';
        }
        
        document.getElementById('start-tour').onclick = () => {
            startTour();
            localStorage.setItem(STORAGE_KEYS.TOUR_DONE, 'true');
        };

        // ========== –°—Ç–∞—Ä—Ç ==========
        renderAll();
    })();
</script>
</body>
</html>
