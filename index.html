<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Simple CRM ‚Äî —Å –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
        }

        /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
        :root {
            --bg-gradient-start: #f5f7fa;
            --bg-gradient-end: #e9edf2;
            --surface: #ffffff;
            --surface-light: #f0f3f7;
            --text-primary: #1a1e24;
            --text-secondary: #4f5a6b;
            --text-tertiary: #7f8a9e;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --border: #d0d7e2;
            --card-bg: #ffffff;
            --warning: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
            --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.06);
            --emoji-brightness: 0.7;
        }

        /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
        .dark-theme {
            --bg-gradient-start: #0f1217;
            --bg-gradient-end: #1a1f2a;
            --surface: #1e2430;
            --surface-light: #2a3140;
            --text-primary: #eef2f6;
            --text-secondary: #9aa4b8;
            --text-tertiary: #6f7a8f;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --border: #2d3545;
            --card-bg: #242b38;
            --warning: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 12px 28px rgba(0, 0, 0, 0.4);
            --emoji-brightness: 1.3;
        }

        /* –ú–æ–Ω–æ—Ö—Ä–æ–º–Ω—ã–π —Ä–µ–∂–∏–º */
        .monochrome .tab,
        .monochrome .stat-card,
        .monochrome .card-title,
        .monochrome .section-hint span:first-child,
        .monochrome .btn,
        .monochrome .add-button,
        .monochrome .integration-card,
        .monochrome .item-details,
        .monochrome .reminder-item,
        .monochrome .footer,
        .monochrome .badge,
        .monochrome .header .plan-tag,
        .monochrome .counter,
        .monochrome .empty-state,
        .monochrome .toggle-task {
            filter: grayscale(100%) brightness(var(--emoji-brightness));
            transition: filter 0.2s ease;
        }

        .logo h1 {
            filter: none;
        }

        body {
            background: linear-gradient(145deg, var(--bg-gradient-start), var(--bg-gradient-end));
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            color: var(--text-primary);
            transition: background 0.3s ease;
        }

        /* –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ */
        .auth-screen {
            max-width: 400px;
            width: 100%;
            background: var(--surface);
            border-radius: 32px;
            padding: 32px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-hover);
        }

        .auth-screen h2 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 24px;
            text-align: center;
        }

        .auth-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: var(--surface-light);
            padding: 6px;
            border-radius: 60px;
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            border-radius: 60px;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            transition: 0.2s;
        }

        .auth-tab.active {
            background: var(--surface);
            color: var(--accent);
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-form input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: 24px;
            font-size: 0.95rem;
            margin-bottom: 16px;
            background: var(--surface-light);
            color: var(--text-primary);
        }

        .auth-form input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .auth-btn {
            width: 100%;
            padding: 14px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 40px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
            margin-top: 8px;
        }

        .auth-btn:hover {
            background: var(--accent-hover);
        }

        .auth-error {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 12px;
            text-align: center;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—Å–∫—Ä—ã—Ç–æ –¥–æ –≤—Ö–æ–¥–∞) */
        .main-content {
            display: none;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        /* –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é (–±—É—Ä–≥–µ—Ä) */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(4px);
            z-index: 2000;
            display: none;
        }

        .menu-panel {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100%;
            background: var(--surface);
            border-right: 1px solid var(--border);
            box-shadow: 4px 0 20px rgba(0,0,0,0.1);
            transition: left 0.3s ease;
            z-index: 2001;
            padding: 24px 16px;
            display: flex;
            flex-direction: column;
        }

        .menu-panel.open {
            left: 0;
        }

        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .menu-header h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .menu-close {
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-tertiary);
        }

        .menu-item {
            padding: 14px 16px;
            margin: 4px 0;
            border-radius: 40px;
            color: var(--text-primary);
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-item:hover {
            background: var(--surface-light);
        }

        .menu-item.logout {
            margin-top: auto;
            color: var(--danger);
        }

        /* –®–∞–ø–∫–∞ —Å –±—É—Ä–≥–µ—Ä–æ–º */
        .header {
            background: var(--surface);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 32px;
            padding: 16px 24px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            position: relative;
        }

        .burger-btn {
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-primary);
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: var(--surface-light);
            border: 1px solid var(--border);
            transition: 0.2s;
        }

        .burger-btn:hover {
            border-color: var(--accent);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .pricing-badge {
            background: var(--surface-light);
            border-radius: 40px;
            padding: 8px 16px;
            display: flex;
            gap: 12px;
            align-items: center;
            border: 1px solid var(--border);
        }

        .plan-tag {
            padding: 4px 12px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .plan-tag.free {
            background: var(--surface);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .plan-tag.pro {
            background: var(--accent);
            color: white;
        }

        .counter {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .control-buttons {
            display: flex;
            gap: 8px;
        }

        .control-btn {
            background: var(--surface-light);
            border: 1px solid var(--border);
            border-radius: 60px;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: 0.2s;
            color: var(--text-primary);
        }

        .control-btn:hover {
            border-color: var(--accent);
            background: var(--surface);
        }

        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ (—Ç–∞–∫–∏–µ –∂–µ, –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏) */
        .tabs-container {
            background: var(--surface);
            border-radius: 32px;
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: var(--surface-light);
            padding: 6px;
            border-radius: 60px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1 1 auto;
            text-align: center;
            padding: 12px 16px;
            font-weight: 500;
            border-radius: 60px;
            background: transparent;
            border: none;
            font-size: 0.95rem;
            color: var(--text-secondary);
            transition: 0.2s;
            cursor: pointer;
            white-space: nowrap;
        }

        .tab.active {
            background: var(--surface);
            color: var(--accent);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--surface-light);
            border-radius: 28px;
            padding: 20px 16px;
            text-align: center;
            border: 1px solid var(--border);
            transition: 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .dashboard-card {
            background: var(--surface-light);
            border-radius: 28px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .card-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
        }

        .reminder-item {
            background: var(--surface);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--accent);
        }

        .reminder-item.urgent {
            border-left-color: var(--warning);
        }

        .reminder-info h4 {
            font-size: 1rem;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .reminder-date {
            font-size: 0.85rem;
            color: var(--text-tertiary);
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 14px 20px;
            border: 1px solid var(--border);
            border-radius: 60px;
            font-size: 0.95rem;
            background: var(--surface-light);
            color: var(--text-primary);
            transition: 0.2s;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .search-box input::placeholder {
            color: var(--text-tertiary);
        }

        .list-container {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 4px;
            margin-bottom: 20px;
        }

        .item-card {
            background: var(--surface-light);
            border-radius: 24px;
            padding: 18px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            transition: 0.2s;
        }

        .item-card:hover {
            border-color: var(--accent);
            box-shadow: var(--shadow-hover);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .item-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .item-details {
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-size: 0.95rem;
        }

        .badge {
            background: var(--surface);
            padding: 4px 12px;
            border-radius: 40px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .btn {
            padding: 8px 16px;
            border-radius: 40px;
            border: none;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: 0.2s;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .btn:hover {
            border-color: var(--accent);
            background: var(--surface-light);
        }

        .btn-primary {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .add-button {
            width: 100%;
            padding: 14px;
            background: var(--surface-light);
            color: var(--accent);
            border: 1px dashed var(--border);
            border-radius: 60px;
            font-weight: 500;
            font-size: 0.95rem;
            margin: 10px 0;
            cursor: pointer;
            transition: 0.2s;
        }

        .add-button:hover {
            border-color: var(--accent);
            background: var(--surface);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(8px);
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 16px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--surface);
            border-radius: 32px;
            max-width: 500px;
            width: 100%;
            padding: 28px;
            border: 1px solid var(--border);
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-hover);
        }

        .modal-content h2 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 20px;
            font-weight: 600;
        }

        .modal-content input,
        .modal-content select,
        .modal-content textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: 24px;
            font-size: 0.95rem;
            margin-bottom: 16px;
            background: var(--surface-light);
            color: var(--text-primary);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .modal-actions button {
            flex: 1;
            padding: 14px;
            border-radius: 40px;
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            background: var(--surface-light);
            border-radius: 28px;
            color: var(--text-tertiary);
            border: 1px solid var(--border);
        }

        .integrations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }

        .integration-card {
            background: var(--surface-light);
            border-radius: 24px;
            padding: 20px 8px;
            text-align: center;
            font-weight: 500;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            transition: 0.2s;
        }

        .integration-card:hover {
            border-color: var(--accent);
        }

        .section-hint {
            background: var(--surface-light);
            border-radius: 20px;
            padding: 14px 16px;
            margin: 20px 0 10px;
            border-left: 4px solid var(--accent);
            color: var(--text-secondary);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            color: var(--text-tertiary);
            font-size: 0.85rem;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--surface-light);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }

        .user-info {
            padding: 16px;
            background: var(--surface-light);
            border-radius: 24px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
        }

        .user-info p {
            color: var(--text-primary);
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div class="auth-screen" id="authScreen">
        <h2>‚ú® Simple CRM</h2>
        <div class="auth-tabs">
            <div class="auth-tab active" data-auth="login">–í—Ö–æ–¥</div>
            <div class="auth-tab" data-auth="register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
        </div>

        <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
        <div class="auth-form active" id="loginForm">
            <input type="text" id="loginUsername" placeholder="–õ–æ–≥–∏–Ω">
            <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="auth-btn" id="loginBtn">–í–æ–π—Ç–∏</button>
            <div class="auth-error" id="loginError"></div>
        </div>

        <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
        <div class="auth-form" id="registerForm">
            <input type="text" id="regUsername" placeholder="–õ–æ–≥–∏–Ω">
            <input type="password" id="regPassword" placeholder="–ü–∞—Ä–æ–ª—å">
            <input type="password" id="regConfirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            <button class="auth-btn" id="registerBtn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <div class="auth-error" id="registerError"></div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—Å–∫—Ä—ã—Ç–æ) -->
    <div class="main-content" id="mainContent">
        <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
        <div class="menu-overlay" id="menuOverlay"></div>
        <div class="menu-panel" id="menuPanel">
            <div class="menu-header">
                <h3>–ú–µ–Ω—é</h3>
                <span class="menu-close" id="menuClose">&times;</span>
            </div>
            <div class="user-info" id="userInfo"></div>
            <div class="menu-item" id="menuSettings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            <div class="menu-item" id="menuProfile">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
            <div class="menu-item" id="menuSupport">üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
            <div class="menu-item logout" id="menuLogout">üö™ –í—ã–π—Ç–∏</div>
        </div>

        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <div class="logo">
                <div class="burger-btn" id="burgerBtn">‚ò∞</div>
                <h1>‚ú® Simple CRM</h1>
            </div>
            <div class="header-right">
                <div class="pricing-badge">
                    <span class="plan-tag free">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                    <span class="plan-tag pro">PRO</span>
                    <span class="counter" id="contact-counter">0 / 10</span>
                </div>
                <div class="control-buttons">
                    <div class="control-btn" id="theme-toggle">‚òÄÔ∏è</div>
                    <div class="control-btn" id="color-toggle">üé®</div>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ª–∏–º–∏—Ç–µ -->
        <div id="limit-warning" class="section-hint" style="display: none; border-left-color: var(--warning);">
            <span>‚ö†Ô∏è</span>
            <span>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–∏–º–∏—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (10) –∏—Å—á–µ—Ä–ø–∞–Ω. –£–¥–∞–ª–∏—Ç–µ –ª–∏—à–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ PRO.</span>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" data-tab="dashboard">üè† –ì–ª–∞–≤–Ω–∞—è</button>
                <button class="tab" data-tab="contacts">üë• –ö–æ–Ω—Ç–∞–∫—Ç—ã</button>
                <button class="tab" data-tab="deals">üíº –°–¥–µ–ª–∫–∏</button>
                <button class="tab" data-tab="tasks">‚úÖ –ó–∞–¥–∞—á–∏</button>
                <button class="tab" data-tab="comments">üí¨ –û–±—Å—É–∂–¥–µ–Ω–∏—è</button>
                <button class="tab" data-tab="integrations">üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</button>
            </div>

            <!-- –ì–õ–ê–í–ù–ê–Ø -->
            <div id="dashboard" class="section active">
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="stat-contacts">0</div><div class="stat-label">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div></div>
                    <div class="stat-card"><div class="stat-value" id="stat-deals">0</div><div class="stat-label">–°–¥–µ–ª–∫–∏</div></div>
                    <div class="stat-card"><div class="stat-value" id="stat-tasks">0</div><div class="stat-label">–ó–∞–¥–∞—á–∏</div></div>
                    <div class="stat-card"><div class="stat-value" id="stat-sum">0‚ÇΩ</div><div class="stat-label">–°—É–º–º–∞</div></div>
                </div>

                <div class="dashboard-card">
                    <div class="card-title">‚è∞ –ù–∞ —Å–µ–≥–æ–¥–Ω—è</div>
                    <div id="today-reminders"></div>
                    <button class="btn btn-primary" id="check-reminders" style="width:100%; margin-top:12px;">üîî –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                </div>

                <div class="dashboard-card">
                    <div class="card-title">üí¨ –ü–æ—Å–ª–µ–¥–Ω–∏–µ</div>
                    <div id="recent-comments"></div>
                </div>
            </div>

            <!-- –ö–û–ù–¢–ê–ö–¢–´ -->
            <div id="contacts" class="section">
                <div class="search-box"><input type="text" id="search-contacts" placeholder="üîç –ü–æ–∏—Å–∫..."></div>
                <div id="contacts-list" class="list-container"></div>
                <button class="add-button" id="show-add-contact">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç</button>
                <div class="section-hint"><span>üë§</span><span>–ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤</span></div>
            </div>

            <!-- –°–î–ï–õ–ö–ò -->
            <div id="deals" class="section">
                <div class="search-box"><input type="text" id="search-deals" placeholder="üîç –ü–æ–∏—Å–∫..."></div>
                <div id="deals-list" class="list-container"></div>
                <button class="add-button" id="show-add-deal">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–¥–µ–ª–∫—É</button>
                <div class="section-hint"><span>üíº</span><span>–ü—Ä–æ–¥–∞–∂–∏ –∏ –≤–æ—Ä–æ–Ω–∫–∞</span></div>
            </div>

            <!-- –ó–ê–î–ê–ß–ò -->
            <div id="tasks" class="section">
                <div class="search-box"><input type="text" id="search-tasks" placeholder="üîç –ü–æ–∏—Å–∫..."></div>
                <div id="tasks-list" class="list-container"></div>
                <button class="add-button" id="show-add-task">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
                <div class="section-hint"><span>‚úÖ</span><span>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</span></div>
            </div>

            <!-- –û–ë–°–£–ñ–î–ï–ù–ò–Ø -->
            <div id="comments" class="section">
                <div class="search-box"><input type="text" id="search-comments" placeholder="üîç –ü–æ–∏—Å–∫..."></div>
                <div id="comments-list" class="list-container"></div>
                <div style="background:var(--surface-light); border-radius:28px; padding:20px; margin:20px 0;">
                    <select id="comment-deal-select" style="width:100%; padding:14px; border-radius:24px; margin-bottom:12px; background:var(--surface); color:var(--text-primary); border:1px solid var(--border);">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–¥–µ–ª–∫—É</option>
                    </select>
                    <input type="text" id="comment-text" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." style="width:100%; padding:14px; border-radius:24px; margin-bottom:12px; background:var(--surface); color:var(--text-primary); border:1px solid var(--border);">
                    <button class="btn btn-primary" id="add-comment-btn" style="width:100%;">üí¨ –î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
                <div class="section-hint"><span>üí¨</span><span>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å–¥–µ–ª–∫–∞–º</span></div>
            </div>

            <!-- –ò–ù–¢–ï–ì–†–ê–¶–ò–ò -->
            <div id="integrations" class="section">
                <div class="integrations-grid">
                    <div class="integration-card">üìß Email</div>
                    <div class="integration-card">üìû –¢–µ–ª–µ—Ñ–æ–Ω–∏—è</div>
                    <div class="integration-card">üì± WhatsApp</div>
                    <div class="integration-card">‚úàÔ∏è Telegram</div>
                    <div class="integration-card">üìä Excel</div>
                    <div class="integration-card">üîå API</div>
                </div>
                <div class="section-hint"><span>üîå</span><span>–°–∫–æ—Ä–æ</span></div>
            </div>
        </div>

        <div class="footer">
            ‚ú® –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title">–î–æ–±–∞–≤–∏—Ç—å</h2>
            <div id="modal-fields"></div>
            <div class="modal-actions">
                <button class="btn" id="modal-cancel">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="modal-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // ========== –ö–ª—é—á–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ ==========
            const STORAGE_KEYS = {
                USERS: 'crm_users',                 // –º–∞—Å—Å–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π {id, login, password}
                SESSION: 'crm_session',              // {userId, login}
                THEME: 'crm_theme',
                COLOR_MODE: 'crm_color_mode'
            };

            // ========== –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ==========
            function getStorage(key) {
                return JSON.parse(localStorage.getItem(key)) || [];
            }

            function setStorage(key, val) {
                localStorage.setItem(key, JSON.stringify(val));
            }

            function generateId() {
                return Date.now() + Math.floor(Math.random() * 10000);
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–µ—Å–ª–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞—ë–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ)
            if (!localStorage.getItem(STORAGE_KEYS.USERS)) {
                setStorage(STORAGE_KEYS.USERS, [
                    { id: 1, login: 'demo', password: 'demo' }
                ]);
            }

            // ========== –¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è ==========
            let currentUser = null;

            // –ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é
            function loadSession() {
                const session = JSON.parse(localStorage.getItem(STORAGE_KEYS.SESSION));
                if (session && session.userId) {
                    const users = getStorage(STORAGE_KEYS.USERS);
                    const user = users.find(u => u.id === session.userId);
                    if (user) {
                        currentUser = { id: user.id, login: user.login };
                        return true;
                    }
                }
                return false;
            }

            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Å—Å–∏—é
            function saveSession(user) {
                currentUser = { id: user.id, login: user.login };
                localStorage.setItem(STORAGE_KEYS.SESSION, JSON.stringify({ userId: user.id, login: user.login }));
            }

            // –û—á–∏—Å—Ç–∏—Ç—å —Å–µ—Å—Å–∏—é (–≤—ã—Ö–æ–¥)
            function clearSession() {
                currentUser = null;
                localStorage.removeItem(STORAGE_KEYS.SESSION);
            }

            // ========== –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ==========
            function getUserDataKey(type) {
                if (!currentUser) return null;
                return `crm_${type}_${currentUser.id}`;
            }

            function getUserData(type) {
                const key = getUserDataKey(type);
                return key ? JSON.parse(localStorage.getItem(key)) || [] : [];
            }

            function setUserData(type, data) {
                const key = getUserDataKey(type);
                if (key) localStorage.setItem(key, JSON.stringify(data));
            }

            // ========== –≠–ª–µ–º–µ–Ω—Ç—ã UI ==========
            const authScreen = document.getElementById('authScreen');
            const mainContent = document.getElementById('mainContent');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const authTabs = document.querySelectorAll('.auth-tab');
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const loginError = document.getElementById('loginError');
            const registerError = document.getElementById('registerError');
            const burgerBtn = document.getElementById('burgerBtn');
            const menuPanel = document.getElementById('menuPanel');
            const menuOverlay = document.getElementById('menuOverlay');
            const menuClose = document.getElementById('menuClose');
            const menuLogout = document.getElementById('menuLogout');
            const userInfo = document.getElementById('userInfo');

            // ========== –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ ==========
            authTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    authTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const form = tab.dataset.auth;
                    document.getElementById('loginForm').classList.remove('active');
                    document.getElementById('registerForm').classList.remove('active');
                    document.getElementById(form + 'Form').classList.add('active');
                    loginError.textContent = '';
                    registerError.textContent = '';
                });
            });

            // ========== –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ==========
            registerBtn.addEventListener('click', () => {
                const login = document.getElementById('regUsername').value.trim();
                const pass = document.getElementById('regPassword').value;
                const confirm = document.getElementById('regConfirm').value;

                if (!login || !pass) {
                    registerError.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                    return;
                }
                if (pass !== confirm) {
                    registerError.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                    return;
                }

                const users = getStorage(STORAGE_KEYS.USERS);
                if (users.find(u => u.login === login)) {
                    registerError.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
                    return;
                }

                const newUser = { id: generateId(), login, password: pass };
                users.push(newUser);
                setStorage(STORAGE_KEYS.USERS, users);

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥
                saveSession(newUser);
                showMainApp();
            });

            // ========== –í—Ö–æ–¥ ==========
            loginBtn.addEventListener('click', () => {
                const login = document.getElementById('loginUsername').value.trim();
                const pass = document.getElementById('loginPassword').value;

                const users = getStorage(STORAGE_KEYS.USERS);
                const user = users.find(u => u.login === login && u.password === pass);
                if (!user) {
                    loginError.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
                    return;
                }

                saveSession(user);
                showMainApp();
            });

            // ========== –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ==========
            function showMainApp() {
                authScreen.style.display = 'none';
                mainContent.style.display = 'block';
                // –û–±–Ω–æ–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ –º–µ–Ω—é
                if (currentUser) {
                    userInfo.innerHTML = `<p>üë§ ${currentUser.login}</p>`;
                }
                // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                loadUserData();
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –∏ —Ü–≤–µ—Ç–Ω–æ—Å—Ç–∏
                initTheme();
                initColorMode();
                renderAll();
            }

            // ========== –í—ã—Ö–æ–¥ ==========
            function logout() {
                clearSession();
                authScreen.style.display = 'block';
                mainContent.style.display = 'none';
                // –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è –≤–≤–æ–¥–∞
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                document.getElementById('regUsername').value = '';
                document.getElementById('regPassword').value = '';
                document.getElementById('regConfirm').value = '';
                loginError.textContent = '';
                registerError.textContent = '';
                // –ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é
                closeMenu();
            }

            menuLogout.addEventListener('click', logout);

            // ========== –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é ==========
            function openMenu() {
                menuPanel.classList.add('open');
                menuOverlay.style.display = 'block';
            }

            function closeMenu() {
                menuPanel.classList.remove('open');
                menuOverlay.style.display = 'none';
            }

            burgerBtn.addEventListener('click', openMenu);
            menuOverlay.addEventListener('click', closeMenu);
            menuClose.addEventListener('click', closeMenu);

            // –ü—É–Ω–∫—Ç—ã –º–µ–Ω—é (–ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –∑–∞–≥–ª—É—à–∫–∏)
            document.getElementById('menuSettings').addEventListener('click', () => {
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
                closeMenu();
            });
            document.getElementById('menuProfile').addEventListener('click', () => {
                alert('–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
                closeMenu();
            });
            document.getElementById('menuSupport').addEventListener('click', () => {
                alert('–ü–æ–¥–¥–µ—Ä–∂–∫–∞ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
                closeMenu();
            });

            // ========== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ==========
            if (loadSession()) {
                showMainApp();
            } else {
                authScreen.style.display = 'block';
                mainContent.style.display = 'none';
            }

            // ========== –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) ==========
            let searchTerms = { contacts: '', deals: '', tasks: '', comments: '' };
            let editingId = null;
            let currentUserame = '–ú–µ–Ω–µ–¥–∂–µ—Ä'; // –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

            // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            function getContacts() { return getUserData('contacts'); }
            function setContacts(data) { setUserData('contacts', data); }
            function getDeals() { return getUserData('deals'); }
            function setDeals(data) { setUserData('deals', data); }
            function getTasks() { return getUserData('tasks'); }
            function setTasks(data) { setUserData('tasks', data); }
            function getComments() { return getUserData('comments'); }
            function setComments(data) { setUserData('comments', data); }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            function loadUserData() {
                if (!currentUser) return;
                if (getContacts().length === 0) {
                    setContacts([
                        { id: 1001, name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', company: '–û–û–û "–†–æ–º–∞—à–∫–∞"', phone: '+7 999 123-45-67', email: 'ivan@example.com' },
                        { id: 1002, name: '–û–ª—å–≥–∞ –°–º–∏—Ä–Ω–æ–≤–∞', company: '–ò–ü –°–º–∏—Ä–Ω–æ–≤–∞', phone: '+7 999 765-43-21', email: 'olga@example.com' }
                    ]);
                }
                if (getDeals().length === 0) {
                    setDeals([
                        { id: 2001, title: '–°–∞–π—Ç –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞', value: 150000, stage: '–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã', contactId: 1001 },
                        { id: 2002, title: '–ü–æ—Å—Ç–∞–≤–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', value: 320000, stage: '–û—Ü–µ–Ω–∫–∞', contactId: 1002 }
                    ]);
                }
                const today = new Date().toISOString().split('T')[0];
                const tomorrow = new Date(Date.now() + 86400000).toISOString().split('T')[0];
                if (getTasks().length === 0) {
                    setTasks([
                        { id: 3001, title: '–ü–æ–∑–≤–æ–Ω–∏—Ç—å –ò–≤–∞–Ω—É', dueDate: today, completed: false, dealId: 2001 },
                        { id: 3002, title: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ö–ü', dueDate: tomorrow, completed: false, dealId: 2002 }
                    ]);
                }
                if (getComments().length === 0) {
                    setComments([
                        { id: 4001, dealId: 2001, text: '–ö–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å–∏—Ç —Å–∫–∏–¥–∫—É 10%', author: currentUser.login, time: new Date().toISOString() },
                        { id: 4002, dealId: 2002, text: '–ñ–¥—ë–º —Ä–µ—à–µ–Ω–∏–µ –¥–æ –ø—è—Ç–Ω–∏—Ü—ã', author: currentUser.login, time: new Date().toISOString() }
                    ]);
                }
            }

            // ========== –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–æ–π ==========
            const themeToggle = document.getElementById('theme-toggle');
            function initTheme() {
                const savedTheme = localStorage.getItem(STORAGE_KEYS.THEME) || 'light';
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-theme');
                    themeToggle.textContent = 'üåô';
                } else {
                    document.body.classList.remove('dark-theme');
                    themeToggle.textContent = '‚òÄÔ∏è';
                }
            }
            function toggleTheme() {
                if (document.body.classList.contains('dark-theme')) {
                    document.body.classList.remove('dark-theme');
                    localStorage.setItem(STORAGE_KEYS.THEME, 'light');
                    themeToggle.textContent = '‚òÄÔ∏è';
                } else {
                    document.body.classList.add('dark-theme');
                    localStorage.setItem(STORAGE_KEYS.THEME, 'dark');
                    themeToggle.textContent = 'üåô';
                }
            }
            themeToggle.addEventListener('click', toggleTheme);

            // ========== –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–Ω–æ—Å—Ç—å—é ==========
            const colorToggle = document.getElementById('color-toggle');
            function initColorMode() {
                const savedMode = localStorage.getItem(STORAGE_KEYS.COLOR_MODE) || 'color';
                if (savedMode === 'monochrome') {
                    document.body.classList.add('monochrome');
                    colorToggle.textContent = '‚ö™';
                } else {
                    document.body.classList.remove('monochrome');
                    colorToggle.textContent = 'üé®';
                }
            }
            function toggleColorMode() {
                if (document.body.classList.contains('monochrome')) {
                    document.body.classList.remove('monochrome');
                    localStorage.setItem(STORAGE_KEYS.COLOR_MODE, 'color');
                    colorToggle.textContent = 'üé®';
                } else {
                    document.body.classList.add('monochrome');
                    localStorage.setItem(STORAGE_KEYS.COLOR_MODE, 'monochrome');
                    colorToggle.textContent = '‚ö™';
                }
            }
            colorToggle.addEventListener('click', toggleColorMode);

            // ========== –§—É–Ω–∫—Ü–∏–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É—é—Ç get... ) ==========
            function escape(s) {
                return s ? String(s).replace(/[&<>"]/g, function(m) {
                    return { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;' }[m];
                }) : '';
            }
            function formatDate(d) { return d ? new Date(d).toLocaleDateString('ru-RU') : ''; }
            function isToday(d) { return d === new Date().toISOString().split('T')[0]; }

            function updateCounters() {
                const contacts = getContacts();
                document.getElementById('contact-counter').innerText = `${contacts.length} / 10`;
                const warning = document.getElementById('limit-warning');
                if (contacts.length >= 10) {
                    warning.style.display = 'flex';
                    warning.style.background = document.body.classList.contains('dark-theme') ? '#2d2620' : '#fff3e0';
                } else {
                    warning.style.display = 'none';
                }
            }

            function renderDashboard() {
                const contacts = getContacts();
                const deals = getDeals();
                const tasks = getTasks();
                const comments = getComments();

                document.getElementById('stat-contacts').innerText = contacts.length;
                document.getElementById('stat-deals').innerText = deals.length;
                document.getElementById('stat-tasks').innerText = tasks.length;
                const sum = deals.reduce((s,d) => s + (d.value||0), 0);
                document.getElementById('stat-sum').innerText = sum.toLocaleString() + '‚ÇΩ';

                const todayTasks = tasks.filter(t => !t.completed && isToday(t.dueDate));
                const remEl = document.getElementById('today-reminders');
                if (todayTasks.length === 0) remEl.innerHTML = '<div class="empty-state">‚úÖ –ù–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ—Ç</div>';
                else {
                    remEl.innerHTML = todayTasks.map(t => `
                        <div class="reminder-item ${isToday(t.dueDate) ? 'urgent' : ''}">
                            <div>
                                <h4>${escape(t.title)}</h4>
                                <div class="reminder-date">${formatDate(t.dueDate)}</div>
                            </div>
                            <button class="btn btn-small toggle-task" data-id="${t.id}">‚úÖ</button>
                        </div>`).join('');
                }

                const recent = comments.slice(-3).reverse();
                const commEl = document.getElementById('recent-comments');
                if (recent.length === 0) commEl.innerHTML = '<div class="empty-state">üí¨ –ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>';
                else {
                    commEl.innerHTML = recent.map(c => {
                        const deal = deals.find(d => d.id === c.dealId);
                        return `<div class="item-card">
                            <b>${escape(c.author)}</b>: ${escape(c.text)}
                            <br><small>${deal ? escape(deal.title) : '‚Äî'} ‚Ä¢ ${new Date(c.time).toLocaleString()}</small>
                        </div>`;
                    }).join('');
                }
            }

            function renderContacts() {
                let items = getContacts();
                const term = searchTerms.contacts.toLowerCase();
                if (term) items = items.filter(c => c.name?.toLowerCase().includes(term) || c.company?.toLowerCase().includes(term));
                const html = items.length ? items.map(c => `
                    <div class="item-card">
                        <div class="item-header">
                            <h3>${escape(c.name)}</h3>
                            <div>
                                <button class="btn btn-small edit-contact" data-id="${c.id}">‚úé</button>
                                <button class="btn btn-small delete-contact" data-id="${c.id}">‚úï</button>
                            </div>
                        </div>
                        <div class="item-details">
                            üè¢ ${escape(c.company||'‚Äî')}<br>
                            üìû ${escape(c.phone||'‚Äî')}<br>
                            ‚úâÔ∏è ${escape(c.email||'‚Äî')}
                        </div>
                    </div>`).join('') : '<div class="empty-state">ü§∑ –ù–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤</div>';
                document.getElementById('contacts-list').innerHTML = html;
            }

            function renderDeals() {
                let items = getDeals();
                const contacts = getContacts();
                const term = searchTerms.deals.toLowerCase();
                if (term) items = items.filter(d => d.title?.toLowerCase().includes(term));
                const html = items.length ? items.map(d => {
                    const contact = contacts.find(c => c.id === d.contactId);
                    return `<div class="item-card">
                        <div class="item-header">
                            <h3>${escape(d.title)}</h3>
                            <div>
                                <button class="btn btn-small edit-deal" data-id="${d.id}">‚úé</button>
                                <button class="btn btn-small delete-deal" data-id="${d.id}">‚úï</button>
                            </div>
                        </div>
                        <div class="item-details">
                            üí∞ ${(d.value||0).toLocaleString()} ‚ÇΩ<br>
                            üìå ${escape(d.stage)}<br>
                            üë§ ${contact ? escape(contact.name) : '‚Äî'}
                        </div>
                    </div>`}).join('') : '<div class="empty-state">üíº –ù–µ—Ç —Å–¥–µ–ª–æ–∫</div>';
                document.getElementById('deals-list').innerHTML = html;
            }

            function renderTasks() {
                let items = getTasks();
                const deals = getDeals();
                const term = searchTerms.tasks.toLowerCase();
                if (term) items = items.filter(t => t.title?.toLowerCase().includes(term));
                const html = items.length ? items.map(t => {
                    const deal = deals.find(d => d.id === t.dealId);
                    return `<div class="item-card" style="opacity:${t.completed?0.6:1}">
                        <div class="item-header">
                            <h3 style="text-decoration:${t.completed?'line-through':'none'}">${escape(t.title)}</h3>
                            <div>
                                <button class="btn btn-small toggle-task" data-id="${t.id}">${t.completed?'‚Ü©Ô∏è':'‚úÖ'}</button>
                                <button class="btn btn-small edit-task" data-id="${t.id}">‚úé</button>
                                <button class="btn btn-small delete-task" data-id="${t.id}">‚úï</button>
                            </div>
                        </div>
                        <div class="item-details">
                            üìÖ ${formatDate(t.dueDate)} ${isToday(t.dueDate)?'üîî':''}<br>
                            üìå ${deal ? escape(deal.title) : '‚Äî'}
                        </div>
                    </div>`}).join('') : '<div class="empty-state">‚úÖ –ù–µ—Ç –∑–∞–¥–∞—á</div>';
                document.getElementById('tasks-list').innerHTML = html;
            }

            function renderComments() {
                let items = getComments();
                const deals = getDeals();
                const term = searchTerms.comments.toLowerCase();
                if (term) items = items.filter(c => c.text?.toLowerCase().includes(term));
                items.sort((a,b) => new Date(b.time) - new Date(a.time));
                const html = items.length ? items.map(c => {
                    const deal = deals.find(d => d.id === c.dealId);
                    return `<div class="item-card">
                        <b>${escape(c.author)}</b>: ${escape(c.text)}
                        <br><small>${deal ? escape(deal.title) : '‚Äî'} ‚Ä¢ ${new Date(c.time).toLocaleString()}</small>
                    </div>`;
                }).join('') : '<div class="empty-state">üí¨ –ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>';
                document.getElementById('comments-list').innerHTML = html;

                const select = document.getElementById('comment-deal-select');
                if (select) {
                    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–¥–µ–ª–∫—É</option>' + 
                        deals.map(d => `<option value="${d.id}">${escape(d.title)}</option>`).join('');
                }
            }

            function renderAll() {
                renderDashboard();
                renderContacts();
                renderDeals();
                renderTasks();
                renderComments();
                updateCounters();
            }

            // ========== –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ==========
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalFields = document.getElementById('modal-fields');
            const modalSave = document.getElementById('modal-save');
            const modalCancel = document.getElementById('modal-cancel');

            function openModal(type, editData = null) {
                editingId = editData ? editData.id : null;
                const contacts = getContacts();
                const deals = getDeals();
                let html = '';

                if (type === 'contact') {
                    modalTitle.innerText = editData ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç' : '–ù–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç';
                    html = `
                        <input type="text" id="modal-name" placeholder="–ò–º—è" value="${escape(editData?.name||'')}">
                        <input type="text" id="modal-company" placeholder="–ö–æ–º–ø–∞–Ω–∏—è" value="${escape(editData?.company||'')}">
                        <input type="tel" id="modal-phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" value="${escape(editData?.phone||'')}">
                        <input type="email" id="modal-email" placeholder="Email" value="${escape(editData?.email||'')}">
                    `;
                } else if (type === 'deal') {
                    modalTitle.innerText = editData ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–¥–µ–ª–∫—É' : '–ù–æ–≤–∞—è —Å–¥–µ–ª–∫–∞';
                    const stages = ['–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã','–û—Ü–µ–Ω–∫–∞','–£—Å–ø–µ—Ö','–ü—Ä–æ–≤–∞–ª'];
                    const stageOpts = stages.map(s => `<option value="${s}" ${editData?.stage===s?'selected':''}>${s}</option>`).join('');
                    const contactOpts = contacts.map(c => `<option value="${c.id}" ${editData?.contactId===c.id?'selected':''}>${escape(c.name)}</option>`).join('');
                    html = `
                        <input type="text" id="modal-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" value="${escape(editData?.title||'')}">
                        <input type="number" id="modal-value" placeholder="–°—É–º–º–∞" value="${editData?.value||''}">
                        <select id="modal-stage">${stageOpts}</select>
                        <select id="modal-contact">${contactOpts}</select>
                    `;
                } else if (type === 'task') {
                    modalTitle.innerText = editData ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É' : '–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞';
                    const dealOpts = deals.map(d => `<option value="${d.id}" ${editData?.dealId===d.id?'selected':''}>${escape(d.title)}</option>`).join('');
                    html = `
                        <input type="text" id="modal-title" placeholder="–ó–∞–¥–∞—á–∞" value="${escape(editData?.title||'')}">
                        <input type="date" id="modal-due" value="${editData?.dueDate||''}">
                        <select id="modal-deal">${dealOpts}</select>
                    `;
                }
                modalFields.innerHTML = html;
                modal.classList.add('active');
                modalSave.dataset.type = type;
            }

            modalCancel.onclick = () => modal.classList.remove('active');
            modalSave.onclick = () => {
                const type = modalSave.dataset.type;
                if (type === 'contact') {
                    const name = document.getElementById('modal-name')?.value.trim();
                    if (!name) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
                    const contacts = getContacts();
                    if (!editingId && contacts.length >= 10) { alert('–õ–∏–º–∏—Ç 10 –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤'); return; }
                    const newItem = { 
                        id: editingId || generateId(), 
                        name, 
                        company: document.getElementById('modal-company')?.value||'', 
                        phone: document.getElementById('modal-phone')?.value||'', 
                        email: document.getElementById('modal-email')?.value||'' 
                    };
                    if (editingId) {
                        const idx = contacts.findIndex(c => c.id === editingId);
                        if (idx>=0) contacts[idx] = newItem;
                    } else contacts.push(newItem);
                    setContacts(contacts);
                    renderContacts(); renderDashboard(); updateCounters();
                } else if (type === 'deal') {
                    const title = document.getElementById('modal-title')?.value.trim();
                    if (!title) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ');
                    const deals = getDeals();
                    const newItem = { 
                        id: editingId || generateId(), 
                        title, 
                        value: parseFloat(document.getElementById('modal-value')?.value)||0, 
                        stage: document.getElementById('modal-stage')?.value, 
                        contactId: parseInt(document.getElementById('modal-contact')?.value)||null 
                    };
                    if (editingId) {
                        const idx = deals.findIndex(d => d.id === editingId);
                        if (idx>=0) deals[idx] = newItem;
                    } else deals.push(newItem);
                    setDeals(deals);
                    renderDeals(); renderDashboard();
                } else if (type === 'task') {
                    const title = document.getElementById('modal-title')?.value.trim();
                    if (!title) return alert('–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É');
                    const tasks = getTasks();
                    const newItem = { 
                        id: editingId || generateId(), 
                        title, 
                        dueDate: document.getElementById('modal-due')?.value, 
                        completed: false, 
                        dealId: parseInt(document.getElementById('modal-deal')?.value)||null 
                    };
                    if (editingId) {
                        const idx = tasks.findIndex(t => t.id === editingId);
                        if (idx>=0) { newItem.completed = tasks[idx].completed; tasks[idx] = newItem; }
                    } else tasks.push(newItem);
                    setTasks(tasks);
                    renderTasks(); renderDashboard();
                }
                modal.classList.remove('active');
            };

            // ========== –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ==========
            document.getElementById('show-add-contact').onclick = () => openModal('contact');
            document.getElementById('show-add-deal').onclick = () => openModal('deal');
            document.getElementById('show-add-task').onclick = () => openModal('task');

            document.getElementById('add-comment-btn').onclick = () => {
                const dealId = parseInt(document.getElementById('comment-deal-select')?.value);
                const text = document.getElementById('comment-text')?.value.trim();
                if (!dealId || !text) return alert('–í—ã–±–µ—Ä–∏—Ç–µ —Å–¥–µ–ª–∫—É –∏ –Ω–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π');
                const comments = getComments();
                comments.push({ 
                    id: generateId(), 
                    dealId, 
                    text, 
                    author: currentUser ? currentUser.login : '–ú–µ–Ω–µ–¥–∂–µ—Ä', 
                    time: new Date().toISOString() 
                });
                setComments(comments);
                document.getElementById('comment-text').value = '';
                renderComments(); renderDashboard();
            };

            document.getElementById('check-reminders').onclick = () => {
                const tasks = getTasks();
                const todayTasks = tasks.filter(t => !t.completed && isToday(t.dueDate));
                alert(todayTasks.length ? `üîî ${todayTasks.length} –∑–∞–¥–∞—á –Ω–∞ —Å–µ–≥–æ–¥–Ω—è` : '‚úÖ –ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–¥–∞—á –Ω–µ—Ç');
            };

            document.addEventListener('click', e => {
                const id = Number(e.target.dataset.id);
                if (e.target.classList.contains('delete-contact')) {
                    if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç?')) return;
                    const contacts = getContacts().filter(c => c.id !== id);
                    setContacts(contacts);
                    renderContacts(); renderDashboard(); updateCounters();
                } else if (e.target.classList.contains('delete-deal')) {
                    if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å–¥–µ–ª–∫—É?')) return;
                    const deals = getDeals().filter(d => d.id !== id);
                    setDeals(deals);
                    renderDeals(); renderDashboard();
                } else if (e.target.classList.contains('delete-task')) {
                    if (!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?')) return;
                    const tasks = getTasks().filter(t => t.id !== id);
                    setTasks(tasks);
                    renderTasks(); renderDashboard();
                } else if (e.target.classList.contains('edit-contact')) {
                    const item = getContacts().find(c => c.id === id);
                    if (item) openModal('contact', item);
                } else if (e.target.classList.contains('edit-deal')) {
                    const item = getDeals().find(d => d.id === id);
                    if (item) openModal('deal', item);
                } else if (e.target.classList.contains('edit-task')) {
                    const item = getTasks().find(t => t.id === id);
                    if (item) openModal('task', item);
                } else if (e.target.classList.contains('toggle-task')) {
                    const tasks = getTasks();
                    const task = tasks.find(t => t.id === id);
                    if (task) { 
                        task.completed = !task.completed; 
                        setTasks(tasks); 
                        renderTasks(); renderDashboard(); 
                    }
                }
            });

            // –ü–æ–∏—Å–∫
            document.getElementById('search-contacts')?.addEventListener('input', e => { 
                searchTerms.contacts = e.target.value; 
                renderContacts(); 
            });
            document.getElementById('search-deals')?.addEventListener('input', e => { 
                searchTerms.deals = e.target.value; 
                renderDeals(); 
            });
            document.getElementById('search-tasks')?.addEventListener('input', e => { 
                searchTerms.tasks = e.target.value; 
                renderTasks(); 
            });
            document.getElementById('search-comments')?.addEventListener('input', e => { 
                searchTerms.comments = e.target.value; 
                renderComments(); 
            });

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });
        })();
    </script>
</body>
</html>
