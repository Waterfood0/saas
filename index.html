<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>–ú–æ—è –ø—Ä–æ—Å—Ç–∞—è CRM ‚Äî –∫—Ä–∞—Å–∏–≤–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        body {
            background: linear-gradient(145deg, #f0f4ff 0%, #f8fafc 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }
        .app {
            max-width: 600px;
            width: 100%;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 42px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.02);
            padding: 24px;
        }
        h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #1e293b, #0f172a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
            letter-spacing: -0.02em;
        }
        .subtitle {
            color: #64748b;
            font-size: 0.95rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .help-btn {
            background: #eef2ff;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #4f46e5;
            cursor: pointer;
            transition: 0.2s;
        }
        .help-btn:hover {
            background: #dbeafe;
            transform: scale(1.05);
        }
        .pricing-card {
            background: white;
            border-radius: 30px;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            box-shadow: 0 8px 20px -6px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(203, 213, 225, 0.4);
        }
        .plan-badge {
            display: flex;
            gap: 10px;
        }
        .badge {
            border-radius: 40px;
            padding: 6px 14px;
            font-weight: 600;
            font-size: 0.85rem;
            letter-spacing: -0.01em;
        }
        .badge.free {
            background: #f1f5f9;
            color: #334155;
            border: 1px solid #cbd5e1;
        }
        .badge.pro {
            background: #0f172a;
            color: white;
        }
        .counter {
            font-weight: 700;
            color: #0f172a;
            background: #f8fafc;
            padding: 4px 12px;
            border-radius: 40px;
            font-size: 0.95rem;
        }
        .tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 24px;
            background: #f1f5f9;
            padding: 6px;
            border-radius: 40px;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px 6px;
            font-weight: 600;
            border-radius: 34px;
            background: transparent;
            border: none;
            font-size: 0.95rem;
            color: #475569;
            transition: 0.2s;
            cursor: pointer;
            white-space: nowrap;
        }
        .tab.active {
            background: white;
            color: #0f172a;
            box-shadow: 0 6px 12px -8px #0f172a20;
        }
        .section {
            display: none;
            animation: fade 0.2s ease;
        }
        .section.active {
            display: block;
        }
        @keyframes fade {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Quick actions */
        .quick-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 28px;
            flex-wrap: wrap;
        }
        .quick-btn {
            flex: 1 1 130px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 60px;
            padding: 14px 10px;
            font-weight: 600;
            font-size: 1rem;
            color: #1e293b;
            box-shadow: 0 4px 10px -4px rgba(0,0,0,0.03);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: 0.15s;
            cursor: pointer;
        }
        .quick-btn:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
            transform: scale(0.98);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 28px;
        }
        .stat-card {
            background: white;
            border-radius: 28px;
            padding: 18px 8px;
            text-align: center;
            box-shadow: 0 6px 14px -8px #0f172a20;
            border: 1px solid #f0f3f7;
        }
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #0f172a;
            line-height: 1.1;
        }
        .stat-label {
            font-size: 0.8rem;
            color: #64748b;
            font-weight: 500;
        }
        .reminder-item {
            background: white;
            border-radius: 20px;
            padding: 14px 16px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid #4f46e5;
            box-shadow: 0 4px 10px -6px #0f172a30;
        }
        .reminder-title {
            font-weight: 600;
            color: #0f172a;
        }
        .reminder-date {
            font-size: 0.8rem;
            color: #64748b;
            margin-top: 4px;
        }
        .list-container {
            margin-bottom: 16px;
            max-height: 380px;
            overflow-y: auto;
            padding-right: 4px;
        }
        .list-item {
            background: white;
            border-radius: 24px;
            padding: 18px;
            margin-bottom: 10px;
            border: 1px solid #f0f3f7;
            box-shadow: 0 4px 12px -8px #0f172a15;
            transition: 0.1s;
        }
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .item-header h4 {
            font-size: 1.2rem;
            font-weight: 700;
            color: #0f172a;
        }
        .item-info p {
            margin: 5px 0;
            color: #475569;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .item-actions {
            display: flex;
            gap: 8px;
        }
        button {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 30px;
            padding: 8px 16px;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: 0.15s;
            color: #1e293b;
            box-shadow: 0 2px 6px -4px #00000010;
        }
        button.primary {
            background: #0f172a;
            border-color: #0f172a;
            color: white;
        }
        button.small {
            padding: 6px 12px;
            font-size: 0.8rem;
        }
        .add-button {
            width: 100%;
            padding: 16px;
            background: #0f172a;
            color: white;
            border: none;
            border-radius: 60px;
            font-weight: 700;
            font-size: 1.05rem;
            margin-top: 8px;
            box-shadow: 0 12px 20px -14px #0f172a;
            transition: 0.15s;
        }
        .add-button:hover {
            background: #1e293b;
            transform: scale(0.98);
        }
        .empty-state {
            text-align: center;
            color: #94a3b8;
            padding: 36px 20px;
            background: #f8fafc;
            border-radius: 32px;
            font-size: 1rem;
            border: 1px dashed #cbd5e1;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(6px);
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 16px;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: white;
            border-radius: 44px;
            max-width: 480px;
            width: 100%;
            padding: 28px;
            box-shadow: 0 30px 60px -20px #0f172a50;
        }
        .modal-content h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 20px;
        }
        .modal-content input,
        .modal-content select {
            width: 100%;
            padding: 16px 18px;
            border: 1px solid #e2e8f0;
            border-radius: 44px;
            font-size: 1rem;
            margin-bottom: 16px;
            background: #f8fafc;
        }
        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        .modal-actions button {
            flex: 1;
            padding: 16px;
            font-weight: 600;
        }
        .hint {
            background: #eef2ff;
            border-radius: 24px;
            padding: 16px;
            font-size: 0.95rem;
            margin-bottom: 20px;
            color: #1e293b;
            border-left: 4px solid #4f46e5;
        }
        .tour-modal .modal-content {
            background: #0f172a;
            color: white;
        }
        .tour-modal h3 { color: white; }
        .tour-modal p { color: #cbd5e1; margin-bottom: 24px; line-height: 1.5; }
        .tour-buttons { display: flex; gap: 12px; }
        .tour-buttons button {
            flex: 1;
            background: #334155;
            border: none;
            color: white;
        }
        .tour-buttons button.primary {
            background: #4f46e5;
        }
        .footer-note {
            margin-top: 30px;
            font-size: 0.8rem;
            color: #94a3b8;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="app">
    <div style="display: flex; align-items: center; justify-content: space-between;">
        <h1>–ú–æ—è CRM</h1>
        <button class="help-btn" id="helpButton">?</button>
    </div>
    <div class="subtitle">
        <span>–¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–¥–∞–∂</span>
    </div>

    <!-- –¢–∞—Ä–∏—Ñ—ã -->
    <div class="pricing-card">
        <div class="plan-badge">
            <span class="badge free">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
            <span class="badge pro">PRO 990 ‚ÇΩ/–º–µ—Å</span>
        </div>
        <div class="counter" id="clients-count">0 / 10</div>
    </div>
    <div id="limit-warning" style="background:#fff1e0; border-radius:40px; padding:12px; margin-bottom:20px; color:#a15400; display:none;">
        ‚ö†Ô∏è –õ–∏–º–∏—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ 10. –£–¥–∞–ª–∏—Ç–µ –ª–∏—à–Ω–∏—Ö –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ PRO.
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="tabs">
        <button class="tab active" data-tab="dashboard">üè† –ì–ª–∞–≤–Ω–∞—è</button>
        <button class="tab" data-tab="clients">üë• –ö–ª–∏–µ–Ω—Ç—ã</button>
        <button class="tab" data-tab="sales">üí∞ –ü—Ä–æ–¥–∞–∂–∏</button>
        <button class="tab" data-tab="reminders">‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</button>
    </div>

    <!-- –ì–ª–∞–≤–Ω–∞—è -->
    <div id="dashboard" class="section active">
        <div class="quick-actions">
            <button class="quick-btn" id="quick-client">‚ûï –ö–ª–∏–µ–Ω—Ç</button>
            <button class="quick-btn" id="quick-sale">‚ûï –ü—Ä–æ–¥–∞–∂–∞</button>
            <button class="quick-btn" id="quick-reminder">‚ûï –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="stat-clients">0</div>
                <div class="stat-label">–ö–ª–∏–µ–Ω—Ç—ã</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-sales">0</div>
                <div class="stat-label">–ü—Ä–æ–¥–∞–∂–∏</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-reminders">0</div>
                <div class="stat-label">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</div>
            </div>
        </div>

        <h3 style="margin-bottom:12px;">üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
        <div id="today-reminders" class="list-container" style="max-height:200px;"></div>

        <div class="hint" id="dashboardHint">
            <strong>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å:</strong> –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´‚ûï –ö–ª–∏–µ–Ω—Ç¬ª ‚Äì –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è. –ü–æ—Ç–æ–º —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–¥–∞–∂—É –∏ –ø—Ä–∏–≤—è–∂–∏—Ç–µ –∫ –Ω–µ–π –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ. –í—Å—ë –ø—Ä–æ—Å—Ç–æ!
        </div>
    </div>

    <!-- –ö–ª–∏–µ–Ω—Ç—ã -->
    <div id="clients" class="section">
        <div class="hint">–ó–¥–µ—Å—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤–∞—à–∏ –∫–ª–∏–µ–Ω—Ç—ã. –ù–∞–∂–º–∏—Ç–µ ¬´‚ûï –î–æ–±–∞–≤–∏—Ç—å¬ª.</div>
        <div id="clients-list" class="list-container"></div>
        <button class="add-button" id="show-add-client">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
    </div>

    <!-- –ü—Ä–æ–¥–∞–∂–∏ -->
    <div id="sales" class="section">
        <div class="hint"><strong>–ü—Ä–æ–¥–∞–∂–∞</strong> ‚Äî —Ç–æ, —á—Ç–æ –ø—Ä–æ–¥–∞—ë—Ç–µ. –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, —Å—É–º–º—É –∏ —ç—Ç–∞–ø.</div>
        <div id="sales-list" class="list-container"></div>
        <button class="add-button" id="show-add-sale">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É</button>
    </div>

    <!-- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
    <div id="reminders" class="section">
        <div class="hint">–ó–∞–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ –∑–≤–æ–Ω–æ–∫ –∏–ª–∏ –≤—Å—Ç—Ä–µ—á—É ‚Äî –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–π.</div>
        <div id="reminders-list" class="list-container"></div>
        <button class="add-button" id="show-add-reminder">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</button>
    </div>

    <div class="footer-note">‚úèÔ∏è –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ</div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div id="modal" class="modal">
    <div class="modal-content">
        <h3 id="modal-title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h3>
        <div id="modal-fields"></div>
        <div class="modal-actions">
            <button id="modal-cancel">–û—Ç–º–µ–Ω–∞</button>
            <button class="primary" id="modal-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±—É—á–µ–Ω–∏—è (—Ç—É—Ä) -->
<div id="tourModal" class="modal tour-modal">
    <div class="modal-content">
        <h3 id="tourTitle">üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>
        <p id="tourText">–≠—Ç–æ –ø—Ä–æ—Å—Ç–∞—è CRM –¥–ª—è —É—á—ë—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–æ–¥–∞–∂. –°–µ–π—á–∞—Å —è –ø–æ–∫–∞–∂—É –æ—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏.</p>
        <div class="tour-buttons">
            <button id="tourPrev" style="display:none;">‚Üê –ù–∞–∑–∞–¥</button>
            <button id="tourNext" class="primary">–î–∞–ª–µ–µ</button>
            <button id="tourClose">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<script>
    (function() {
        // --- –•—Ä–∞–Ω–∏–ª–∏—â–µ –∏ –∫–ª—é—á–∏ ---
        const STORAGE_KEYS = {
            CLIENTS: 'crm_clients_beauty',
            SALES: 'crm_sales_beauty',
            REMINDERS: 'crm_reminders_beauty',
            TOUR_DONE: 'crm_tour_done'
        };

        class Storage {
            static get(key) {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : [];
            }
            static set(key, value) {
                localStorage.setItem(key, JSON.stringify(value));
            }
        }

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –ø—É—Å—Ç–æ ---
        if (Storage.get(STORAGE_KEYS.CLIENTS).length === 0) {
            Storage.set(STORAGE_KEYS.CLIENTS, [
                { id: 1, name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', company: '–û–û–û –†–æ–º–∞—à–∫–∞', phone: '+7 999 123-45-67' },
                { id: 2, name: '–û–ª—å–≥–∞ –°–º–∏—Ä–Ω–æ–≤–∞', company: '–ò–ü –°–º–∏—Ä–Ω–æ–≤–∞', phone: '+7 999 765-43-21' }
            ]);
        }
        if (Storage.get(STORAGE_KEYS.SALES).length === 0) {
            Storage.set(STORAGE_KEYS.SALES, [
                { id: 3, title: '–°–∞–π—Ç –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞', value: 150000, stage: '–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã', clientId: 1 },
                { id: 4, title: '–ü–æ—Å—Ç–∞–≤–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', value: 320000, stage: '–û—Ü–µ–Ω–∫–∞', clientId: 2 }
            ]);
        }
        if (Storage.get(STORAGE_KEYS.REMINDERS).length === 0) {
            const today = new Date().toISOString().split('T')[0];
            Storage.set(STORAGE_KEYS.REMINDERS, [
                { id: 5, title: '–ü–æ–∑–≤–æ–Ω–∏—Ç—å –ò–≤–∞–Ω—É', dueDate: today, completed: false, saleId: 3 },
                { id: 6, title: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ö–ü', dueDate: today, completed: false, saleId: 4 }
            ]);
        }

        let editingId = null;
        let currentTab = 'dashboard';

        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---
        function generateId() {
            return Date.now() + Math.floor(Math.random() * 1000);
        }

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe.replace(/[&<>"']/g, function(m) {
                if (m === '&') return '&amp;';
                if (m === '<') return '&lt;';
                if (m === '>') return '&gt;';
                if (m === '"') return '&quot;';
                return '&#039;';
            });
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const d = new Date(dateStr);
            return d.toLocaleDateString('ru-RU');
        }

        function isToday(dateStr) {
            return dateStr === new Date().toISOString().split('T')[0];
        }

        function updateCounters() {
            const clients = Storage.get(STORAGE_KEYS.CLIENTS);
            document.getElementById('clients-count').innerText = `${clients.length} / 10`;
            document.getElementById('limit-warning').style.display = clients.length >= 10 ? 'block' : 'none';
            document.getElementById('stat-clients').innerText = clients.length;
            document.getElementById('stat-sales').innerText = Storage.get(STORAGE_KEYS.SALES).length;
            document.getElementById('stat-reminders').innerText = Storage.get(STORAGE_KEYS.REMINDERS).length;
        }

        // --- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ ---
        function renderDashboard() {
            const reminders = Storage.get(STORAGE_KEYS.REMINDERS);
            const today = reminders.filter(r => !r.completed && isToday(r.dueDate));
            const container = document.getElementById('today-reminders');
            if (today.length === 0) {
                container.innerHTML = '<div class="empty-state">‚úÖ –ù–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –Ω–µ—Ç</div>';
            } else {
                container.innerHTML = today.map(r => `
                    <div class="reminder-item">
                        <div>
                            <div class="reminder-title">${escapeHtml(r.title)}</div>
                            <div class="reminder-date">${formatDate(r.dueDate)}</div>
                        </div>
                        <button class="small toggle-reminder" data-id="${r.id}">‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                    </div>
                `).join('');
            }
        }

        function renderClients() {
            const clients = Storage.get(STORAGE_KEYS.CLIENTS);
            const container = document.getElementById('clients-list');
            if (clients.length === 0) {
                container.innerHTML = '<div class="empty-state">ü§∑ –ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤</div>';
                return;
            }
            container.innerHTML = clients.map(c => `
                <div class="list-item" data-id="${c.id}">
                    <div class="item-header">
                        <h4>${escapeHtml(c.name)}</h4>
                        <div class="item-actions">
                            <button class="small edit-client" data-id="${c.id}">‚úé</button>
                            <button class="small delete-client" data-id="${c.id}">‚úï</button>
                        </div>
                    </div>
                    <div class="item-info">
                        <p>üè¢ ${escapeHtml(c.company || '‚Äî')}</p>
                        <p>üìû ${escapeHtml(c.phone || '‚Äî')}</p>
                    </div>
                </div>
            `).join('');
        }

        function renderSales() {
            const sales = Storage.get(STORAGE_KEYS.SALES);
            const clients = Storage.get(STORAGE_KEYS.CLIENTS);
            const container = document.getElementById('sales-list');
            if (sales.length === 0) {
                container.innerHTML = '<div class="empty-state">üíº –ù–µ—Ç –ø—Ä–æ–¥–∞–∂</div>';
                return;
            }
            container.innerHTML = sales.map(s => {
                const client = clients.find(c => c.id === s.clientId);
                return `
                <div class="list-item" data-id="${s.id}">
                    <div class="item-header">
                        <h4>${escapeHtml(s.title)}</h4>
                        <div class="item-actions">
                            <button class="small edit-sale" data-id="${s.id}">‚úé</button>
                            <button class="small delete-sale" data-id="${s.id}">‚úï</button>
                        </div>
                    </div>
                    <div class="item-info">
                        <p>üí∞ ${s.value?.toLocaleString() || 0} ‚ÇΩ</p>
                        <p>üìå –≠—Ç–∞–ø: ${escapeHtml(s.stage)}</p>
                        <p>üë§ –ö–ª–∏–µ–Ω—Ç: ${client ? escapeHtml(client.name) : '‚Äî'}</p>
                    </div>
                </div>
            `}).join('');
        }

        function renderReminders() {
            const reminders = Storage.get(STORAGE_KEYS.REMINDERS);
            const sales = Storage.get(STORAGE_KEYS.SALES);
            const container = document.getElementById('reminders-list');
            if (reminders.length === 0) {
                container.innerHTML = '<div class="empty-state">‚úÖ –ù–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</div>';
                return;
            }
            container.innerHTML = reminders.map(r => {
                const sale = sales.find(s => s.id === r.saleId);
                return `
                <div class="list-item" data-id="${r.id}">
                    <div class="item-header">
                        <h4 style="${r.completed ? 'text-decoration: line-through; opacity:0.6;' : ''}">${escapeHtml(r.title)}</h4>
                        <div class="item-actions">
                            <button class="small toggle-reminder" data-id="${r.id}">${r.completed ? '‚Ü©Ô∏è' : '‚úÖ'}</button>
                            <button class="small edit-reminder" data-id="${r.id}">‚úé</button>
                            <button class="small delete-reminder" data-id="${r.id}">‚úï</button>
                        </div>
                    </div>
                    <div class="item-info">
                        <p>üìÖ ${formatDate(r.dueDate)} ${isToday(r.dueDate) ? 'üîî –°–µ–≥–æ–¥–Ω—è' : ''}</p>
                        <p>üìå –ü—Ä–æ–¥–∞–∂–∞: ${sale ? escapeHtml(sale.title) : '‚Äî'}</p>
                    </div>
                </div>
            `}).join('');
        }

        function renderAll() {
            renderDashboard();
            renderClients();
            renderSales();
            renderReminders();
            updateCounters();
        }

        // --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ---
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalFields = document.getElementById('modal-fields');
        const modalSave = document.getElementById('modal-save');
        const modalCancel = document.getElementById('modal-cancel');

        function openModal(type, editData = null) {
            editingId = editData ? editData.id : null;
            let fieldsHtml = '';
            const clients = Storage.get(STORAGE_KEYS.CLIENTS);
            const sales = Storage.get(STORAGE_KEYS.SALES);

            if (type === 'client') {
                modalTitle.innerText = editData ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞' : '–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç';
                fieldsHtml = `
                    <input type="text" id="modal-client-name" placeholder="–ò–º—è *" value="${escapeHtml(editData?.name || '')}">
                    <input type="text" id="modal-client-company" placeholder="–ö–æ–º–ø–∞–Ω–∏—è" value="${escapeHtml(editData?.company || '')}">
                    <input type="tel" id="modal-client-phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" value="${escapeHtml(editData?.phone || '')}">
                `;
            } else if (type === 'sale') {
                modalTitle.innerText = editData ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–∂—É' : '–ù–æ–≤–∞—è –ø—Ä–æ–¥–∞–∂–∞';
                const stageOptions = ['–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã', '–£—Å–ø–µ—Ö', '–ü—Ä–æ–≤–∞–ª'].map(s => 
                    `<option value="${s}" ${editData?.stage === s ? 'selected' : ''}>${s}</option>`
                ).join('');
                const clientOptions = clients.map(c => 
                    `<option value="${c.id}" ${editData?.clientId === c.id ? 'selected' : ''}>${escapeHtml(c.name)}</option>`
                ).join('');
                fieldsHtml = `
                    <input type="text" id="modal-sale-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ *" value="${escapeHtml(editData?.title || '')}">
                    <input type="number" id="modal-sale-value" placeholder="–°—É–º–º–∞" value="${editData?.value || ''}">
                    <select id="modal-sale-stage">${stageOptions}</select>
                    <select id="modal-sale-client">${clientOptions}</select>
                `;
            } else if (type === 'reminder') {
                modalTitle.innerText = editData ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ' : '–ù–æ–≤–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ';
                const saleOptions = sales.map(s => 
                    `<option value="${s.id}" ${editData?.saleId === s.id ? 'selected' : ''}>${escapeHtml(s.title)}</option>`
                ).join('');
                fieldsHtml = `
                    <input type="text" id="modal-reminder-title" placeholder="–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å? *" value="${escapeHtml(editData?.title || '')}">
                    <input type="date" id="modal-reminder-due" value="${editData?.dueDate || ''}">
                    <select id="modal-reminder-sale">${saleOptions}</select>
                `;
            }
            modalFields.innerHTML = fieldsHtml;
            modal.classList.add('active');
            modalSave.dataset.type = type;
        }

        function closeModal() {
            modal.classList.remove('active');
            editingId = null;
        }

        modalCancel.addEventListener('click', closeModal);

        modalSave.addEventListener('click', () => {
            const type = modalSave.dataset.type;

            if (type === 'client') {
                const name = document.getElementById('modal-client-name')?.value.trim();
                if (!name) { alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è'); return; }
                const clients = Storage.get(STORAGE_KEYS.CLIENTS);
                if (!editingId && clients.length >= 10) {
                    alert('–õ–∏–º–∏—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ 10. –£–¥–∞–ª–∏—Ç–µ –ª–∏—à–Ω–∏—Ö.');
                    closeModal();
                    return;
                }
                const newClient = {
                    id: editingId || generateId(),
                    name,
                    company: document.getElementById('modal-client-company')?.value.trim() || '',
                    phone: document.getElementById('modal-client-phone')?.value.trim() || ''
                };
                if (editingId) {
                    const index = clients.findIndex(c => c.id === editingId);
                    if (index !== -1) clients[index] = newClient;
                } else {
                    clients.push(newClient);
                }
                Storage.set(STORAGE_KEYS.CLIENTS, clients);
                renderClients();
                renderAll();
            } else if (type === 'sale') {
                const title = document.getElementById('modal-sale-title')?.value.trim();
                if (!title) { alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'); return; }
                const sales = Storage.get(STORAGE_KEYS.SALES);
                const newSale = {
                    id: editingId || generateId(),
                    title,
                    value: parseFloat(document.getElementById('modal-sale-value')?.value) || 0,
                    stage: document.getElementById('modal-sale-stage')?.value || '–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã',
                    clientId: parseInt(document.getElementById('modal-sale-client')?.value) || null
                };
                if (editingId) {
                    const index = sales.findIndex(s => s.id === editingId);
                    if (index !== -1) sales[index] = newSale;
                } else {
                    sales.push(newSale);
                }
                Storage.set(STORAGE_KEYS.SALES, sales);
                renderSales();
                renderAll();
            } else if (type === 'reminder') {
                const title = document.getElementById('modal-reminder-title')?.value.trim();
                if (!title) { alert('–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É'); return; }
                const reminders = Storage.get(STORAGE_KEYS.REMINDERS);
                const newReminder = {
                    id: editingId || generateId(),
                    title,
                    dueDate: document.getElementById('modal-reminder-due')?.value || '',
                    completed: false,
                    saleId: parseInt(document.getElementById('modal-reminder-sale')?.value) || null
                };
                if (editingId) {
                    const index = reminders.findIndex(r => r.id === editingId);
                    if (index !== -1) {
                        newReminder.completed = reminders[index].completed;
                        reminders[index] = newReminder;
                    }
                } else {
                    reminders.push(newReminder);
                }
                Storage.set(STORAGE_KEYS.REMINDERS, reminders);
                renderReminders();
                renderAll();
            }
            closeModal();
        });

        // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ "–î–æ–±–∞–≤–∏—Ç—å" –∏ –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π ---
        document.getElementById('quick-client').addEventListener('click', () => openModal('client'));
        document.getElementById('quick-sale').addEventListener('click', () => openModal('sale'));
        document.getElementById('quick-reminder').addEventListener('click', () => openModal('reminder'));
        document.getElementById('show-add-client').addEventListener('click', () => openModal('client'));
        document.getElementById('show-add-sale').addEventListener('click', () => openModal('sale'));
        document.getElementById('show-add-reminder').addEventListener('click', () => openModal('reminder'));

        // --- –£–¥–∞–ª–µ–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–¥–∞—á ---
        document.addEventListener('click', (e) => {
            const id = Number(e.target.dataset.id);
            if (e.target.classList.contains('delete-client')) {
                if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞?')) return;
                let items = Storage.get(STORAGE_KEYS.CLIENTS).filter(i => i.id !== id);
                Storage.set(STORAGE_KEYS.CLIENTS, items);
                renderAll();
            }
            if (e.target.classList.contains('delete-sale')) {
                if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É?')) return;
                let items = Storage.get(STORAGE_KEYS.SALES).filter(i => i.id !== id);
                Storage.set(STORAGE_KEYS.SALES, items);
                renderAll();
            }
            if (e.target.classList.contains('delete-reminder')) {
                if (!confirm('–£–¥–∞–ª–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ?')) return;
                let items = Storage.get(STORAGE_KEYS.REMINDERS).filter(i => i.id !== id);
                Storage.set(STORAGE_KEYS.REMINDERS, items);
                renderAll();
            }
            if (e.target.classList.contains('edit-client')) {
                const item = Storage.get(STORAGE_KEYS.CLIENTS).find(i => i.id === id);
                if (item) openModal('client', item);
            }
            if (e.target.classList.contains('edit-sale')) {
                const item = Storage.get(STORAGE_KEYS.SALES).find(i => i.id === id);
                if (item) openModal('sale', item);
            }
            if (e.target.classList.contains('edit-reminder')) {
                const item = Storage.get(STORAGE_KEYS.REMINDERS).find(i => i.id === id);
                if (item) openModal('reminder', item);
            }
            if (e.target.classList.contains('toggle-reminder')) {
                const reminders = Storage.get(STORAGE_KEYS.REMINDERS);
                const r = reminders.find(r => r.id === id);
                if (r) {
                    r.completed = !r.completed;
                    Storage.set(STORAGE_KEYS.REMINDERS, reminders);
                    renderAll();
                }
            }
        });

        // --- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ ---
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const targetId = tab.dataset.tab;
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(targetId).classList.add('active');
                currentTab = targetId;
            });
        });

        // --- –û–±—É—á–µ–Ω–∏–µ (—Ç—É—Ä) ---
        const tourModal = document.getElementById('tourModal');
        const tourTitle = document.getElementById('tourTitle');
        const tourText = document.getElementById('tourText');
        const tourPrev = document.getElementById('tourPrev');
        const tourNext = document.getElementById('tourNext');
        const tourClose = document.getElementById('tourClose');
        let tourStep = 0;

        const steps = [
            { title: 'üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', text: '–≠—Ç–æ –ø—Ä–æ—Å—Ç–∞—è CRM, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–º–æ–∂–µ—Ç –Ω–µ –∑–∞–±—ã–≤–∞—Ç—å –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö –∏ –ø—Ä–æ–¥–∞–∂–∞—Ö. –Ø –ø—Ä–æ–≤–µ–¥—É –∫–æ—Ä–æ—Ç–∫–∏–π —Ç—É—Ä.' },
            { title: 'üè† –ì–ª–∞–≤–Ω–∞—è', text: '–ó–¥–µ—Å—å –≤—ã –≤–∏–¥–∏—Ç–µ –æ–±—â—É—é –∫–∞—Ä—Ç–∏–Ω—É: —Å–∫–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–≤, –ø—Ä–æ–¥–∞–∂, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π. –¢–∞–∫–∂–µ –∑–¥–µ—Å—å –µ—Å—Ç—å –±—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è.' },
            { title: 'üë• –ö–ª–∏–µ–Ω—Ç—ã', text: '–ù–∞ –≤–∫–ª–∞–¥–∫–µ ¬´–ö–ª–∏–µ–Ω—Ç—ã¬ª –≤—ã –¥–æ–±–∞–≤–ª—è–µ—Ç–µ –≤—Å–µ—Ö, —Å –∫–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç–µ. –ù–∞–∂–º–∏—Ç–µ ¬´‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞¬ª, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è ‚Äî –≥–æ—Ç–æ–≤–æ.' },
            { title: 'üí∞ –ü—Ä–æ–¥–∞–∂–∏', text: '–í —Ä–∞–∑–¥–µ–ª–µ ¬´–ü—Ä–æ–¥–∞–∂–∏¬ª —Å–æ–∑–¥–∞—ë—Ç–µ —Ç–æ, —á—Ç–æ –ø—Ä–æ–¥–∞—ë—Ç–µ. –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, —Å—É–º–º—É –∏ —ç—Ç–∞–ø (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã¬ª).' },
            { title: '‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è', text: '–ó–¥–µ—Å—å –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∑–≤–æ–Ω–∫–∏ –∏ –≤—Å—Ç—Ä–µ—á–∏. –í –Ω—É–∂–Ω—ã–π –¥–µ–Ω—å –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–π. –ù–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ!' },
            { title: '‚ú® –í—Å—ë!', text: '–¢–µ–ø–µ—Ä—å –≤—ã –≥–æ—Ç–æ–≤—ã —Ä–∞–±–æ—Ç–∞—Ç—å. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ ‚Äî –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´?¬ª –≤–≤–µ—Ä—Ö—É, –∏ —Ç—É—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —Å–Ω–æ–≤–∞.' }
        ];

        function showTourStep(step) {
            if (step < 0 || step >= steps.length) {
                tourModal.classList.remove('active');
                return;
            }
            tourTitle.innerText = steps[step].title;
            tourText.innerText = steps[step].text;
            tourPrev.style.display = step === 0 ? 'none' : 'inline-block';
            tourNext.innerText = step === steps.length - 1 ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å' : '–î–∞–ª–µ–µ';
        }

        function startTour() {
            tourStep = 0;
            showTourStep(tourStep);
            tourModal.classList.add('active');
        }

        // –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç—É—Ä
        if (!localStorage.getItem(STORAGE_KEYS.TOUR_DONE)) {
            setTimeout(startTour, 300);
            localStorage.setItem(STORAGE_KEYS.TOUR_DONE, 'true');
        }

        document.getElementById('helpButton').addEventListener('click', startTour);

        tourNext.addEventListener('click', () => {
            if (tourStep === steps.length - 1) {
                tourModal.classList.remove('active');
            } else {
                tourStep++;
                showTourStep(tourStep);
            }
        });

        tourPrev.addEventListener('click', () => {
            if (tourStep > 0) {
                tourStep--;
                showTourStep(tourStep);
            }
        });

        tourClose.addEventListener('click', () => {
            tourModal.classList.remove('active');
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ —Ç—É—Ä–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ (–Ω–æ –ª—É—á—à–µ –Ω–µ –Ω–∞–¥–æ, –æ—Å—Ç–∞–≤–∏–º —Ç–∞–∫)
        window.addEventListener('click', (e) => {
            if (e.target === tourModal) {
                tourModal.classList.remove('active');
            }
        });

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
        renderAll();

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
        (function checkReminders() {
            const reminders = Storage.get(STORAGE_KEYS.REMINDERS);
            const today = reminders.filter(r => !r.completed && isToday(r.dueDate));
            if (today.length > 0) {
                // –ú–æ–∂–Ω–æ –Ω–µ–Ω–∞–≤—è–∑—á–∏–≤–æ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–Ω–æ –Ω–µ alert, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–¥—Ä–∞–∂–∞—Ç—å)
                const hint = document.getElementById('dashboardHint');
                hint.innerHTML = `üîî <strong>–ù–∞ —Å–µ–≥–æ–¥–Ω—è ${today.length} –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π!</strong> –ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–æ–∑–≤–æ–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞–º.`;
            }
        })();
    })();
</script>
</body>
    </html>
